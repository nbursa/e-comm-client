import{Q as V,f as p}from"./currency-DB7qk38O.js";import{U as E,I as M,aG as W,ad as D,ab as F,ac as R,ae as z,aH as G,r as H,l as k,e as L,aI as O,V as m,W as X,X as v,_ as o,a6 as Y,a0 as d,Y as l,$ as r,aj as f,Z,a1 as C,a3 as q,a5 as I,ak as J,a4 as K}from"./index-td9DqLSI.js";import{Q as tt}from"./QPage-GaTdVrVi.js";import{u as et}from"./products-DC0t_lyP.js";import"./rates-8fxteb9s.js";const st={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},at={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ot={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},it={class:"tw-flex tw-justify-start tw-gap-2"},ct={class:"tw-text-sm tw-mb-2"},rt={class:"tw-text-xs"},lt={class:"text-caption q-mt-sm"},nt={class:"q-mt-sm text-bold price-text"},dt={class:"text-grey"},ut={class:"text-positive q-ml-sm"},pt={class:"row justify-center q-mt-xl"},yt=E({__name:"SingleProductPage",setup(mt){const $=M("scrollToTop"),g="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),n=new Map,Q=W(),w=D(),c=F(),S=R(),{t:T}=z(),h=et(),P=G(),t=H({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),y=k(()=>c.dark.isActive?"white":"black"),_=k(()=>c.dark.isActive?"black":"white"),u=e=>{if(!e)return"/assets/placeholder.webp";const s=n.get(e);if(s)return s;if(e.startsWith("/static")){const i=`${g}${e}`;return n.set(e,i),i}return e.startsWith("http")&&n.set(e,e),e},j=e=>{const s=[{src:u(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const i=t.value.additionalImages.map(x=>({src:u(x),name:t.value.name||t.value.title||""}));s.push(...i)}P.openPreview(s)},B=e=>{S.addItem({...e,quantity:1}),$(),c.notify({color:"positive",position:"top",timeout:1e3,message:T("singleProduct.itemAdded"),icon:"check_circle"})},U=()=>{w.push("/products")},A=async()=>{const{slug:e}=Q.params;c.loading.show();try{const s=h.getCache("viewed");if(s){const b=s.products.find(N=>N.id===Number(e));if(b){t.value=b;return}}const i=await fetch(`${g}/products/${e}`);if(!i.ok)throw new Error(`API returned ${i.status}`);const a=(await i.json()).data;t.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},h.setCache([t.value],"viewed")}catch(s){console.warn("Error fetching product:",s),c.notify({color:"negative",position:"top",timeout:1e3,message:"Failed to fetch product details.",icon:"error"}),t.value.id||w.push("/products")}finally{c.loading.hide()}};return L(async()=>{await A()}),O(()=>{n.clear()}),(e,s)=>(m(),X(tt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:v(()=>[o("div",st,[o("div",{class:Y(["row items-stretch full-height",{"col-reverse-md":d(c).screen.md}])},[o("div",at,[l(V,{src:u(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:s[0]||(s[0]=i=>j(t.value.image))},null,8,["src","alt"])]),o("div",ot,[l(Z,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:v(()=>[o("h5",it,[o("span",null,r(t.value.name||t.value.title),1),o("span",ct,[f("("+r(t.value.quantity)+" ",1),o("span",rt,r(e.$t("singleProduct.quantity")),1),s[2]||(s[2]=f(")"))])]),o("div",lt,r(t.value.description),1)]),_:1}),l(K,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:v(()=>[o("div",nt,[t.value.discount?(m(),C(q,{key:0},[o("s",dt,r(d(p)(t.value.price)),1),o("span",ut,r(d(p)(t.value.discountedPrice||t.value.price)),1)],64)):(m(),C(q,{key:1},[f(r(d(p)(t.value.price)),1)],64))]),l(I,{color:y.value,"text-color":_.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:s[1]||(s[1]=J(i=>B(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",pt,[l(I,{color:y.value,"text-color":_.value,label:e.$t("singleProduct.backToProducts"),onClick:U},null,8,["color","text-color","label"])])]),_:1}))}});export{yt as default};
