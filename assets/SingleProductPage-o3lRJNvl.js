import{q as X,a0 as Z,a1 as tt,c as u,x as b,W as j,B as et,U as at,a_ as g,a7 as st,a6 as ot,a$ as nt,b0 as S,d as lt,Y as ct,b1 as it,an as rt,al as ut,am as dt,ac as wt,b2 as mt,y,b3 as vt,a8 as ft,o as r,a as V,w as k,k as v,e as w,b4 as pt,h as o,t as c,ar as gt,n as ht,j as C,z as xt,ad as T,g as _t,l as bt,F as z,Q as N,aj as yt,aU as E}from"./index-cFqgTMcu.js";import{Q as kt}from"./QImg-BIX_KIQV.js";import{Q as Ct}from"./QPage-BWxXLbnH.js";import{f as U}from"./currency-CYS7ikQW.js";import{u as It}from"./products-XNzdzumV.js";import{api as Pt}from"./axios-DMk5jP5Y.js";import"./rates-Bz7OoHUL.js";const qt=X({name:"QBanner",props:{...Z,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(l,{slots:n}){const{proxy:{$q:m}}=et(),f=tt(l,m),h=u(()=>"q-banner row items-center"+(l.dense===!0?" q-banner--dense":"")+(f.value===!0?" q-banner--dark q-dark":"")+(l.rounded===!0?" rounded-borders":"")),i=u(()=>`q-banner__actions row items-center justify-end col-${l.inlineActions===!0?"auto":"all"}`);return()=>{const p=[b("div",{class:"q-banner__avatar col-auto row items-center self-start"},j(n.avatar)),b("div",{class:"q-banner__content col text-body2"},j(n.default))],d=j(n.action);return d!==void 0&&p.push(b("div",{class:i.value},d)),b("div",{class:h.value+(l.inlineActions===!1&&d!==void 0?" q-banner--top-padding":""),role:"alert"},p)}}});function $t(l){{const n={active:!0};if(typeof l=="function"){const m=u(l);n.val=m.value,at(m,f=>{n.val=f,n.active===!0&&g()})}else n.val=l;S.push(n),g(),st(()=>{n.active=!0,g()}),ot(()=>{n.active=!1,g()}),nt(()=>{S.splice(S.indexOf(n),1),g()})}}const Qt={key:0,class:"tw-p-4"},Bt={key:1,class:"tw-p-4"},jt={key:2,class:"tw-flex tw-w-full tw-mx-auto tw-flex-col tw-justify-center tw-items-center tw-gap-3",style:{"max-width":"1200px"}},St={class:"tw-flex tw-w-full !tw-flex-col tw-items-baseline !tw-justify-between sm:!tw-justify-start md:tw-mb-8"},Tt={class:"tw-text-3xl tw-mt-4 tw-font-semibold tw-font-serif tw-mr-4"},Ut={class:"tw-text-base"},At={class:"tw-flex !tw-flex-col !tw-w-full tw-gap-4 sm:!tw-flex-row"},Dt={class:"tw-col-span-12 sm:!tw-col-span-6 tw-w-full tw-px-0 tw-transition tw-duration-500 tw-ease-in-out hover:tw-scale-105"},Vt={key:1,class:"tw-h-full tw-w-full tw-relative"},zt={class:"tw-col-span-12 sm:!tw-col-span-6 tw-w-full tw-flex tw-flex-col tw-flex-grow-0 tw-h-auto tw-min-h-full sm:!tw-py-0 !tw-align-top"},Nt={class:"!tw-w-full tw-flex tw-font-serif tw-justify-end tw-gap-2"},Et={class:"tw-text-sm tw-mb-2"},Ft={class:"tw-text-xs"},Lt={class:"tw-text-base"},Mt={class:"text-bold tw-text-xl tw-pb-5"},Rt={class:"tw-text-gray-500 tw-mr-1 tw-text-base tw-line-through"},Gt={class:"tw-text-green-600"},Ht={class:"tw-w-full tw-flex tw-justify-between tw-gap-4"},te=lt({__name:"SingleProductPage",setup(l){const n=ct("scrollToTop"),m="https://e-comm-api-8eba0f6c8782.herokuapp.com/api".replace(/\/$/,""),f=it(),h=rt(),i=ut(),p=dt(),{t:d}=wt(),I=It(),F=mt(),{slug:A}=f.params,t=y(null),x=y(!0),P=y(null),q=y(new Map),D=u(()=>i.dark.isActive),$=u(()=>i.dark.isActive?"white":"black"),Q=u(()=>i.dark.isActive?"black":"white"),L=u(()=>`${t.value?.name||t.value?.title||""} - ${vt}`),M=u(()=>p.items.some(e=>e.id===t.value?.id)),R=e=>{if(!q.value.has(e)){const a=new Image;a.src=e,a.onload=()=>{q.value.set(e,a)}}},G=e=>{const a=q.value.get(e);return a?a.src:e},B=e=>{if(!e)return"";const a=`${m}${e}`,s=G(a);return s||(R(a),a)},H=u(()=>t.value?.image?B(t.value.image):""),O=e=>{const a=[{src:B(e),name:t.value?.name||t.value?.title||""}];if(t.value&&t.value.additionalImages?.length){const s=t.value.additionalImages.map(_=>({src:B(_),name:t.value&&(t.value.name||t.value.title)||""}));a.push(...s)}F.openPreview(a)},W=e=>{p.addItem({...e,quantity:1}),n(),i.notify({color:"positive",position:"top",timeout:1e3,message:d("singleProduct.itemAdded"),icon:"check_circle"})},Y=()=>{h.back()},J=async()=>{x.value=!0,i.loading.show();try{I.initViewedCache();const e=I.getViewedCache();if(e){const _=e.products.find(K=>K.id===Number(A));if(_){t.value=_,x.value=!1;return}}const a=await Pt.get(`${m}${E}/${A}`);if(a.status!==200)throw new Error("Failed to fetch product");const{data:s}=a.data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},I.setViewedCache(t.value)}catch(e){console.warn("Error fetching product:",e),P.value=d("errors.fetchProduct"),i.notify({color:"negative",position:"top",timeout:1e3,message:d("errors.fetchProduct"),icon:"error"}),(!t.value||!t.value.id)&&h.push(E)}finally{i.loading.hide(),x.value=!1}};return ft(()=>{J(),$t({title:L.value})}),(e,a)=>(r(),V(Ct,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4 !tw-px-3"},{default:k(()=>[x.value?(r(),v("div",Qt,[w(pt,{color:Q.value,size:"50px"},null,8,["color"])])):P.value?(r(),v("div",Bt,[w(qt,{type:"negative",class:"q-mb-md"},{default:k(()=>[o("div",null,c(P.value),1)]),_:1})])):(r(),v("div",jt,[o("div",St,[o("span",Tt,c(t.value?.name),1),o("span",Ut,c(t.value?.category),1)]),w(gt),o("div",At,[o("div",Dt,[t.value?.image?(r(),v("div",Vt,[w(xt,{name:"zoom_out_map",color:$.value,size:"lg",class:"tw-flex tw-items-center tw-justify-center !tw-absolute tw-bottom-0 tw-right-0 tw-m-2 tw-cursor-pointer tw-z-10"},null,8,["color"]),w(kt,{src:H.value,alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height !tw-rounded-md",onClick:a[0]||(a[0]=s=>O(t.value.image))},null,8,["src","alt"])])):(r(),v("div",{key:0,class:ht(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400 tw-pb-2",D.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},c(C(d)("errors.noImage")),3))]),o("div",zt,[o("h5",Nt,[o("span",Et,[T("("+c(t.value?.quantity)+" ",1),o("span",Ft,c(e.$t("singleProduct.quantity")),1),a[2]||(a[2]=T(")"))])]),w(_t,{class:"tw-flex tw-flex-col tw-flex-1 tw-h-full !tw-px-0"},{default:k(()=>[o("div",Lt,c(t.value?.description),1)]),_:1}),w(bt,{class:"!tw-flex !tw-justify-between !tw-items-end tw-gap-2 !tw-p-0"},{default:k(()=>[o("div",Mt,[t.value?.discount?(r(),v(z,{key:0},[o("span",Rt,c(C(U)(t.value?.price)),1),o("span",Gt,c(C(U)(t.value?.discountedPrice||t.value?.price)),1)],64)):(r(),v(z,{key:1},[T(c(t.value?.price!==void 0?C(U)(t.value.price):""),1)],64))]),o("div",Ht,[w(N,{color:Q.value,"text-color":$.value,outline:D.value,label:e.$t("singleProduct.goBack"),"class-name":"tw-flex-1 tw-basis-1/3",onClick:Y},null,8,["color","text-color","outline","label"]),M.value?yt("",!0):(r(),V(N,{key:0,color:$.value,"text-color":Q.value,label:e.$t("singleProduct.addToCart"),"class-name":"tw-flex-1 tw-basis-2/3",onClick:a[1]||(a[1]=s=>t.value&&W(t.value))},null,8,["color","text-color","label"]))])]),_:1})])])]))]),_:1}))}});export{te as default};
