import{p as K,$ as ee,a0 as te,c as d,v as _,V as T,A as ae,S as se,aT as f,a6 as oe,a5 as ne,aU as ie,aV as A,d as le,X as re,aW as ce,am as ue,ak as de,al as me,ab as pe,aX as ve,x as k,aY as we,a7 as fe,o as u,a as D,w as q,h as p,e as v,aZ as ge,f as n,t as r,n as N,g,ac as B,Q as he,F as E,k as M,ae as F,j as ye,aN as L}from"./index-DfxAW1dS.js";import{Q as xe}from"./QImg-B51yunjy.js";import{Q as be}from"./QPage-Dku7Jvto.js";import{f as Q}from"./currency-Bk7J4wcc.js";import{u as _e}from"./products-4fsMwggY.js";import{api as ke}from"./axios-eTy1plTX.js";import"./rates-73YNyK4P.js";const qe=K({name:"QBanner",props:{...ee,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:o}){const{proxy:{$q:m}}=ae(),w=te(i,m),h=d(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(w.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),l=d(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const y=[_("div",{class:"q-banner__avatar col-auto row items-center self-start"},T(o.avatar)),_("div",{class:"q-banner__content col text-body2"},T(o.default))],c=T(o.action);return c!==void 0&&y.push(_("div",{class:l.value},c)),_("div",{class:h.value+(i.inlineActions===!1&&c!==void 0?" q-banner--top-padding":""),role:"alert"},y)}}});function Ce(i){{const o={active:!0};if(typeof i=="function"){const m=d(i);o.val=m.value,se(m,w=>{o.val=w,o.active===!0&&f()})}else o.val=i;A.push(o),f(),oe(()=>{o.active=!0,f()}),ne(()=>{o.active=!1,f()}),ie(()=>{A.splice(A.indexOf(o),1),f()})}}const Ie={key:0,class:"q-pa-md"},Pe={key:1,class:"q-pa-md"},$e={key:2,class:"q-mb-md q-mx-auto overflow-hidden !tw-w-full row items-stretch justify-center",style:{"max-width":"1200px"}},Te={class:"col-12 col-sm-6 col-md-4 tw-px-2 sm:tw-px-0 tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},Ae={class:"col-12 col-sm-6 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},Be={class:"tw-flex tw-justify-between tw-gap-2"},Qe={class:"tw-text-base md:tw-text-xl"},Se={class:"tw-text-sm tw-mb-2"},Ue={class:"tw-text-xs"},je={class:"text-caption q-mt-sm"},Ve={class:"q-mt-sm text-bold price-text"},De={class:"text-grey"},Ne={class:"text-positive q-ml-sm"},Ee={class:"tw-w-full tw-flex tw-justify-between tw-gap-4"},He=le({__name:"SingleProductPage",setup(i){const o=re("scrollToTop"),m="https://e-comm-api-8eba0f6c8782.herokuapp.com/api".replace(/\/$/,""),w=ce(),h=ue(),l=de(),y=me(),{t:c}=pe(),C=_e(),R=ve(),{slug:S}=w.params,e=k({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=k(!0),I=k(null),P=k(new Map),U=d(()=>l.dark.isActive),j=d(()=>l.dark.isActive?"white":"black"),V=d(()=>l.dark.isActive?"black":"white"),z=d(()=>`${e.value.name||e.value.title} - ${we}`),X=s=>{if(!P.value.has(s)){const t=new Image;t.src=s,t.onload=()=>{P.value.set(s,t)}}},G=s=>{const t=P.value.get(s);return t?t.src:s},$=s=>{if(!s)return"";const t=`${m}${s}`,a=G(t);return a||(X(t),t)},H=d(()=>e.value?.image?$(e.value.image):""),O=s=>{const t=[{src:$(s),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const a=e.value.additionalImages.map(b=>({src:$(b),name:e.value.name||e.value.title||""}));t.push(...a)}R.openPreview(t)},W=s=>{y.addItem({...s,quantity:1}),o(),l.notify({color:"positive",position:"top",timeout:1e3,message:c("singleProduct.itemAdded"),icon:"check_circle"})},Y=()=>{h.back()},Z=async()=>{x.value=!0,l.loading.show();try{C.initViewedCache();const s=C.getViewedCache();if(s){const b=s.products.find(J=>J.id===Number(S));if(b){e.value=b,x.value=!1;return}}const t=await ke.get(`${m}${L}/${S}`);if(t.status!==200)throw new Error("Failed to fetch product");const{data:a}=t.data;e.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},C.setViewedCache(e.value)}catch(s){console.warn("Error fetching product:",s),I.value=c("errors.fetchProduct"),l.notify({color:"negative",position:"top",timeout:1e3,message:c("errors.fetchProduct"),icon:"error"}),e.value.id||h.push(L)}finally{l.loading.hide(),x.value=!1}};return fe(()=>{Z(),Ce({title:z.value})}),(s,t)=>(u(),D(be,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4"},{default:q(()=>[x.value?(u(),p("div",Ie,[v(ge,{color:"primary",size:"50px"})])):I.value?(u(),p("div",Pe,[v(qe,{type:"negative",class:"q-mb-md"},{default:q(()=>[n("div",null,r(I.value),1)]),_:1})])):(u(),p("div",$e,[n("div",{class:N(["row items-stretch full-height !tw-w-full justify-center",{"col-reverse-md":g(l).screen.sm}])},[n("div",Te,[e.value.image?(u(),D(xe,{key:1,src:H.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:t[0]||(t[0]=a=>O(e.value.image))},null,8,["src","alt"])):(u(),p("div",{key:0,class:N(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400",U.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},r(g(c)("errors.noImage")),3))]),n("div",Ae,[v(he,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:q(()=>[n("h5",Be,[n("span",Qe,r(e.value.name||e.value.title),1),n("span",Se,[B("("+r(e.value.quantity)+" ",1),n("span",Ue,r(s.$t("singleProduct.quantity")),1),t[3]||(t[3]=B(")"))])]),n("div",je,r(e.value.description),1)]),_:1}),v(ye,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:q(()=>[n("div",Ve,[e.value.discount?(u(),p(E,{key:0},[n("s",De,r(g(Q)(e.value.price)),1),n("span",Ne,r(g(Q)(e.value.discountedPrice||e.value.price)),1)],64)):(u(),p(E,{key:1},[B(r(g(Q)(e.value.price)),1)],64))]),n("div",Ee,[v(M,{color:V.value,"text-color":j.value,outline:U.value,label:s.$t("singleProduct.goBack"),class:"!tw-p-4 tw-flex-1 tw-basis-1/3",onClick:t[1]||(t[1]=F(a=>Y(),["stop"]))},null,8,["color","text-color","outline","label"]),v(M,{color:j.value,"text-color":V.value,label:s.$t("singleProduct.addToCart"),class:"!tw-p-4 tw-flex-1 tw-basis-2/3",onClick:t[2]||(t[2]=F(a=>W(e.value),["stop"]))},null,8,["color","text-color","label"])])]),_:1})])],2)]))]),_:1}))}});export{He as default};
