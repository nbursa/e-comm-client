import{p as J,a7 as K,a8 as ee,c as d,B as x,C as $,D as te,a1 as ae,aT as w,z as se,y as oe,aU as L,aV as I,d as ne,a4 as ie,aW as re,al as le,aj as ce,ak as ue,ab as de,aX as me,q as T,aY as pe,A as ve,o as u,a as V,w as k,h as v,e as f,aZ as fe,f as n,t as c,n as E,g as h,ag as A,Q as ge,F as M,k as z,aG as we,j as he,aN as B}from"./index-Cu7LU0FT.js";import{Q as ye}from"./QImg-CBCbBxIZ.js";import{Q as _e}from"./QPage-D_EcSBCz.js";import{f as Q}from"./currency-CUBvSzUn.js";import{u as be}from"./products-CPSWgJoA.js";import{api as xe}from"./axios-CVSTLC5p.js";import"./rates-D7sNIUiv.js";const ke=J({name:"QBanner",props:{...K,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(r,{slots:s}){const{proxy:{$q:m}}=te(),p=ee(r,m),q=d(()=>"q-banner row items-center"+(r.dense===!0?" q-banner--dense":"")+(p.value===!0?" q-banner--dark q-dark":"")+(r.rounded===!0?" rounded-borders":"")),y=d(()=>`q-banner__actions row items-center justify-end col-${r.inlineActions===!0?"auto":"all"}`);return()=>{const i=[x("div",{class:"q-banner__avatar col-auto row items-center self-start"},$(s.avatar)),x("div",{class:"q-banner__content col text-body2"},$(s.default))],g=$(s.action);return g!==void 0&&i.push(x("div",{class:y.value},g)),x("div",{class:q.value+(r.inlineActions===!1&&g!==void 0?" q-banner--top-padding":""),role:"alert"},i)}}});function F(r){{const s={active:!0};if(typeof r=="function"){const m=d(r);s.val=m.value,ae(m,p=>{s.val=p,s.active===!0&&w()})}else s.val=r;I.push(s),w(),se(()=>{s.active=!0,w()}),oe(()=>{s.active=!1,w()}),L(()=>{I.splice(I.indexOf(s),1),w()})}}const qe={key:0,class:"q-pa-md"},Ce={key:1,class:"q-pa-md"},Pe={key:2,class:"q-mb-md q-mx-auto overflow-hidden !tw-w-full row items-stretch justify-center",style:{"max-width":"1200px"}},$e={class:"col-12 col-sm-6 col-md-4 tw-px-2 sm:tw-px-0 tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},Ie={class:"col-12 col-sm-6 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},Te={class:"tw-flex tw-justify-between tw-gap-2"},Ae={class:"tw-text-base md:tw-text-xl"},Be={class:"tw-text-sm tw-mb-2"},Qe={class:"tw-text-xs"},Se={class:"text-caption q-mt-sm"},je={class:"q-mt-sm text-bold price-text"},De={class:"text-grey"},Ue={class:"text-positive q-ml-sm"},Ne={class:"row justify-center q-mt-xl"},Ge=ne({__name:"SingleProductPage",setup(r){const s=ie("scrollToTop"),m="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),p=new Map,q=re(),y=le(),i=ce(),g=ue(),{t:_}=de(),S=be(),R=me(),e=T({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),b=T(!0),C=T(null),G=d(()=>i.dark.isActive),j=d(()=>i.dark.isActive?"white":"black"),D=d(()=>i.dark.isActive?"black":"white"),U=d(()=>`${e.value.name||e.value.title} - ${pe}`),P=o=>{if(!o)return"";const t=`${m}${o}`,l=p.get(t);return l||(p.set(t,t),t)},H=d(()=>e.value?.image?P(e.value.image):""),O=o=>{const t=[{src:P(o),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const l=e.value.additionalImages.map(a=>({src:P(a),name:e.value.name||e.value.title||""}));t.push(...l)}R.openPreview(t)},W=o=>{g.addItem({...o,quantity:1}),s(),i.notify({color:"positive",position:"top",timeout:1e3,message:_("singleProduct.itemAdded"),icon:"check_circle"})},X=()=>{y.push(B)},Y=async()=>{const{slug:o}=q.params;b.value=!0,i.loading.show();try{const t=S.getViewedCache();if(t){const N=t.products.find(Z=>Z.id===Number(o));if(N){e.value=N,F({title:U.value}),b.value=!1;return}}const l=await xe.get(`${m}${B}/${o}`);if(l.status!==200)throw new Error("Failed to fetch product");const{data:a}=l.data;e.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},S.setViewedCache(e.value),F({title:U.value})}catch(t){console.warn("Error fetching product:",t),C.value=_("errors.fetchProduct"),i.notify({color:"negative",position:"top",timeout:1e3,message:_("errors.fetchProduct"),icon:"error"}),e.value.id||y.push(B)}finally{i.loading.hide(),b.value=!1}};return ve(()=>{Y()}),L(()=>{p.clear()}),(o,t)=>(u(),V(_e,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4"},{default:k(()=>[b.value?(u(),v("div",qe,[f(fe,{color:"primary",size:"50px"})])):C.value?(u(),v("div",Ce,[f(ke,{type:"negative",class:"q-mb-md"},{default:k(()=>[n("div",null,c(C.value),1)]),_:1})])):(u(),v("div",Pe,[n("div",{class:E(["row items-stretch full-height !tw-w-full justify-center",{"col-reverse-md":h(i).screen.sm}])},[n("div",$e,[e.value.image?(u(),V(ye,{key:1,src:H.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:t[0]||(t[0]=l=>O(e.value.image))},null,8,["src","alt"])):(u(),v("div",{key:0,class:E(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400",G.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},c(h(_)("errors.noImage")),3))]),n("div",Ie,[f(ge,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:k(()=>[n("h5",Te,[n("span",Ae,c(e.value.name||e.value.title),1),n("span",Be,[A("("+c(e.value.quantity)+" ",1),n("span",Qe,c(o.$t("singleProduct.quantity")),1),t[2]||(t[2]=A(")"))])]),n("div",Se,c(e.value.description),1)]),_:1}),f(he,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:k(()=>[n("div",je,[e.value.discount?(u(),v(M,{key:0},[n("s",De,c(h(Q)(e.value.price)),1),n("span",Ue,c(h(Q)(e.value.discountedPrice||e.value.price)),1)],64)):(u(),v(M,{key:1},[A(c(h(Q)(e.value.price)),1)],64))]),f(z,{color:j.value,"text-color":D.value,label:o.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:t[1]||(t[1]=we(l=>W(e.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)])),n("div",Ne,[f(z,{color:j.value,"text-color":D.value,label:o.$t("singleProduct.backToProducts"),onClick:X},null,8,["color","text-color","label"])])]),_:1}))}});export{Ge as default};
