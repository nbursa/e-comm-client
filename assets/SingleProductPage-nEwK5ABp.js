import{Q as N,f as h}from"./currency-Ccvo26dD.js";import{W,L as E,aI as L,af as M,ad as R,ae as D,ag as F,aJ as z,r as J,q as b,e as K,aK as O,X as f,Y as X,Z as v,a0 as a,a8 as Y,a2 as m,_ as d,a1 as l,al as w,$ as Z,a3 as k,a5 as q,a7 as I,am as G,a6 as H}from"./index-D7uZC5ry.js";import{Q as ee}from"./QPage-BTuxgixX.js";import{u as te}from"./products-BA3291Jp.js";import"./rates-8UJCudJn.js";const oe={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},se={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ae={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},ce={class:"tw-flex tw-justify-start tw-gap-2"},ie={class:"tw-text-sm tw-mb-2"},le={class:"tw-text-xs"},re={class:"text-caption q-mt-sm"},ne={class:"q-mt-sm text-bold price-text"},de={class:"text-grey"},ue={class:"text-positive q-ml-sm"},pe={class:"row justify-center q-mt-xl"},xe=W({__name:"SingleProductPage",setup(me){const $=E("scrollToTop"),u="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),p=new Map,P=L(),y=M(),i=R(),Q=D(),{t:S}=F(),r=te(),T=z(),t=J({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=b(()=>i.dark.isActive?"white":"black"),_=b(()=>i.dark.isActive?"black":"white"),g=e=>{if(!e)return"/assets/placeholder.webp";const o=p.get(e);if(o)return o;if(e.startsWith("/static")){const c=`${u}${e}`;return p.set(e,c),c}return e.startsWith("http")&&p.set(e,e),e},U=e=>{const o=[{src:g(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const c=t.value.additionalImages.map(n=>({src:g(n),name:t.value.name||t.value.title||""}));o.push(...c)}T.openPreview(o)},A=e=>{Q.addItem({...e,quantity:1}),$(),i.notify({color:"positive",position:"top",timeout:1e3,message:S("singleProduct.itemAdded"),icon:"check_circle"})},B=()=>{y.push("/products")},V=async()=>{const{slug:e}=P.params;i.loading.show();try{console.log("Checking cache for product:",e);const o=r.getCache("viewed");if(console.log("Viewed cache:",o),o&&r.isCacheValid("viewed")){const C=o.products.find(j=>j.id===Number(e));if(C){console.log("Cache hit for product:",e),t.value=C;return}}console.log("Cache miss, fetching from API");const c=u.endsWith("/products")?u.slice(0,-9):u;console.log("API URL:",c,`${c}/products/${e}`);const n=await fetch(`${c}/products/${e}`);if(!n.ok)throw new Error(`API returned ${n.status}`);const s=(await n.json()).data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},r.setCache([t.value],"viewed"),console.log("Updated cache with new product data")}catch(o){console.warn("Error fetching product:",o),i.notify({color:"negative",position:"top",timeout:1e3,message:"Failed to fetch product details.",icon:"error"}),t.value.id||y.push("/products")}finally{i.loading.hide()}};return K(async()=>{await V()}),O(()=>{p.clear(),r.isCacheValid("viewed")||(console.log("Clearing expired product cache"),r.setCache([],"viewed"))}),(e,o)=>(f(),X(ee,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:v(()=>[a("div",oe,[a("div",{class:Y(["row items-stretch full-height",{"col-reverse-md":m(i).screen.md}])},[a("div",se,[d(N,{src:g(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:o[0]||(o[0]=c=>U(t.value.image))},null,8,["src","alt"])]),a("div",ae,[d(Z,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:v(()=>[a("h5",ce,[a("span",null,l(t.value.name||t.value.title),1),a("span",ie,[w("("+l(t.value.quantity)+" ",1),a("span",le,l(e.$t("singleProduct.quantity")),1),o[2]||(o[2]=w(")"))])]),a("div",re,l(t.value.description),1)]),_:1}),d(H,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:v(()=>[a("div",ne,[t.value.discount?(f(),k(q,{key:0},[a("s",de,l(m(h)(t.value.price)),1),a("span",ue,l(m(h)(t.value.discountedPrice||t.value.price)),1)],64)):(f(),k(q,{key:1},[w(l(m(h)(t.value.price)),1)],64))]),d(I,{color:x.value,"text-color":_.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:o[1]||(o[1]=G(c=>A(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),a("div",pe,[d(I,{color:x.value,"text-color":_.value,label:e.$t("singleProduct.backToProducts"),onClick:B},null,8,["color","text-color","label"])])]),_:1}))}});export{xe as default};
