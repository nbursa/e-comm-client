import{Q as V,f}from"./currency-JPOb14VY.js";import{W,L as E,aI as M,af as D,ad as L,ae as R,ag as z,aJ as F,r as J,q,e as K,aK as O,X as v,Y as X,Z as g,a0 as o,a8 as Y,a2 as p,_ as l,a1 as c,al as w,$ as Z,a3 as C,a5 as I,a7 as $,am as G,a6 as H}from"./index-cQjNMZeo.js";import{Q as tt}from"./QPage-DIWfs-vE.js";import{u as et}from"./products-ChvJn3uM.js";import"./rates-CNNU1jiw.js";const st={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},at={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ot={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},it={class:"tw-flex tw-justify-start tw-gap-2"},rt={class:"tw-text-sm tw-mb-2"},ct={class:"tw-text-xs"},nt={class:"text-caption q-mt-sm"},lt={class:"q-mt-sm text-bold price-text"},dt={class:"text-grey"},ut={class:"text-positive q-ml-sm"},pt={class:"row justify-center q-mt-xl"},_t=W({__name:"SingleProductPage",setup(mt){const P=E("scrollToTop"),d="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),u=new Map,Q=M(),h=D(),r=L(),S=R(),{t:y}=z(),_=et(),T=F(),t=J({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=q(()=>r.dark.isActive?"white":"black"),b=q(()=>r.dark.isActive?"black":"white"),m=e=>{if(!e)return"/assets/placeholder.webp";const s=u.get(e);if(s)return s;if(e.startsWith("/static")){const i=`${d}${e}`;return u.set(e,i),i}return e.startsWith("http")&&u.set(e,e),e},B=e=>{const s=[{src:m(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const i=t.value.additionalImages.map(n=>({src:m(n),name:t.value.name||t.value.title||""}));s.push(...i)}T.openPreview(s)},U=e=>{S.addItem({...e,quantity:1}),P(),r.notify({color:"positive",position:"top",timeout:1e3,message:y("singleProduct.itemAdded"),icon:"check_circle"})},j=()=>{h.push("/products")},A=async()=>{const{slug:e}=Q.params;r.loading.show();try{const s=_.getViewedCache();if(s){const k=s.products.find(N=>N.id===Number(e));if(k){t.value=k;return}}const i=d.endsWith("/products")?d.slice(0,-9):d,n=await fetch(`${i}/products/${e}`);if(!n.ok)throw new Error(`API returned ${n.status}`);const a=(await n.json()).data;t.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},_.setViewedCache(t.value)}catch(s){console.warn("Error fetching product:",s),r.notify({color:"negative",position:"top",timeout:1e3,message:y("errors.fetchProduct"),icon:"error"}),t.value.id||h.push("/products")}finally{r.loading.hide()}};return K(async()=>{await A()}),O(()=>{u.clear()}),(e,s)=>(v(),X(tt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:g(()=>[o("div",st,[o("div",{class:Y(["row items-stretch full-height",{"col-reverse-md":p(r).screen.md}])},[o("div",at,[l(V,{src:m(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:s[0]||(s[0]=i=>B(t.value.image))},null,8,["src","alt"])]),o("div",ot,[l(Z,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:g(()=>[o("h5",it,[o("span",null,c(t.value.name||t.value.title),1),o("span",rt,[w("("+c(t.value.quantity)+" ",1),o("span",ct,c(e.$t("singleProduct.quantity")),1),s[2]||(s[2]=w(")"))])]),o("div",nt,c(t.value.description),1)]),_:1}),l(H,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:g(()=>[o("div",lt,[t.value.discount?(v(),C(I,{key:0},[o("s",dt,c(p(f)(t.value.price)),1),o("span",ut,c(p(f)(t.value.discountedPrice||t.value.price)),1)],64)):(v(),C(I,{key:1},[w(c(p(f)(t.value.price)),1)],64))]),l($,{color:x.value,"text-color":b.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:s[1]||(s[1]=G(i=>U(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",pt,[l($,{color:x.value,"text-color":b.value,label:e.$t("singleProduct.backToProducts"),onClick:j},null,8,["color","text-color","label"])])]),_:1}))}});export{_t as default};
