import{Q as N,f as g}from"./currency-CiHaIKva.js";import{Y as E,O as L,aJ as M,ah as R,af as W,ag as D,ai as F,aK as O,r as z,w as b,h as J,aL as K,Z as f,_ as Y,$ as v,a2 as a,aa as Z,a4 as m,a0 as d,a3 as l,an as w,a1 as G,a5 as k,a7 as q,a9 as $,ao as H,a8 as X}from"./index-9txCErRn.js";import{Q as ee}from"./QPage-D0YDMU8Y.js";import{u as te}from"./products-Df4odDa-.js";import"./rates-ci5AbRAw.js";const oe={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},se={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ae={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},ie={class:"tw-flex tw-justify-start tw-gap-2"},ce={class:"tw-text-sm tw-mb-2"},le={class:"tw-text-xs"},re={class:"text-caption q-mt-sm"},ne={class:"q-mt-sm text-bold price-text"},de={class:"text-grey"},ue={class:"text-positive q-ml-sm"},pe={class:"row justify-center q-mt-xl"},xe=E({__name:"SingleProductPage",setup(me){const I=L("scrollToTop"),u="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),p=new Map,P=M(),y=R(),c=W(),Q=D(),{t:S}=F(),r=te(),T=O(),t=z({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=b(()=>c.dark.isActive?"white":"black"),_=b(()=>c.dark.isActive?"black":"white"),h=e=>{if(!e)return"/assets/placeholder.webp";const o=p.get(e);if(o)return o;if(e.startsWith("/static")){const i=`${u}${e}`;return p.set(e,i),i}return e.startsWith("http")&&p.set(e,e),e},U=e=>{const o=[{src:h(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const i=t.value.additionalImages.map(n=>({src:h(n),name:t.value.name||t.value.title||""}));o.push(...i)}T.openPreview(o)},A=e=>{Q.addItem({...e,quantity:1}),I(),c.notify({color:"positive",position:"top",timeout:1e3,message:S("singleProduct.itemAdded"),icon:"check_circle"})},B=()=>{y.push("/products")},V=async()=>{const{slug:e}=P.params;c.loading.show();try{console.log("Checking cache for product:",e);const o=r.getCache("viewed");if(console.log("Viewed cache:",o),o&&r.isCacheValid("viewed")){const C=o.products.find(j=>j.id===Number(e));if(C){console.log("Cache hit for product:",e),t.value=C;return}}console.log("Cache miss, fetching from API");const i=u.endsWith("/products")?u.slice(0,-9):u;console.log("API URL:",i,`${i}/products/${e}`);const n=await fetch(`${i}/products/${e}`);if(!n.ok)throw new Error(`API returned ${n.status}`);const s=(await n.json()).data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},r.setCache([t.value],"viewed"),console.log("Updated cache with new product data")}catch(o){console.warn("Error fetching product:",o),c.notify({color:"negative",position:"top",timeout:1e3,message:"Failed to fetch product details.",icon:"error"}),t.value.id||y.push("/products")}finally{c.loading.hide()}};return J(async()=>{await V()}),K(()=>{p.clear(),r.isCacheValid("viewed")||(console.log("Clearing expired product cache"),r.setCache([],"viewed"))}),(e,o)=>(f(),Y(ee,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:v(()=>[a("div",oe,[a("div",{class:Z(["row items-stretch full-height",{"col-reverse-md":m(c).screen.md}])},[a("div",se,[d(N,{src:h(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:o[0]||(o[0]=i=>U(t.value.image))},null,8,["src","alt"])]),a("div",ae,[d(G,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:v(()=>[a("h5",ie,[a("span",null,l(t.value.name||t.value.title),1),a("span",ce,[w("("+l(t.value.quantity)+" ",1),a("span",le,l(e.$t("singleProduct.quantity")),1),o[2]||(o[2]=w(")"))])]),a("div",re,l(t.value.description),1)]),_:1}),d(X,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:v(()=>[a("div",ne,[t.value.discount?(f(),k(q,{key:0},[a("s",de,l(m(g)(t.value.price)),1),a("span",ue,l(m(g)(t.value.discountedPrice||t.value.price)),1)],64)):(f(),k(q,{key:1},[w(l(m(g)(t.value.price)),1)],64))]),d($,{color:x.value,"text-color":_.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:o[1]||(o[1]=H(i=>A(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),a("div",pe,[d($,{color:x.value,"text-color":_.value,label:e.$t("singleProduct.backToProducts"),onClick:B},null,8,["color","text-color","label"])])]),_:1}))}});export{xe as default};
