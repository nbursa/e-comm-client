import{d as E,a as F,c as A,e as D,f as G,g as O,r as s,o as $,h as H,j as a,k as r,w as l,l as h,m as n,n as J,t as C,p as K,q,v as u,x as V,y as Q,z as T}from"./index-Cw1-6oTs.js";import{Q as W}from"./QForm-SEfvORme.js";import{Q as X}from"./QPage-crSimVfK.js";const Y={class:"tw-w-full sm:tw-max-w-72 tw-mx-auto"},Z={class:"tw-text-3xl tw-text-center tw-mb-8 tw-font-semibold tw-font-serif"},ee={class:"tw-w-full tw-flex tw-justify-center tw-items-center"},se={key:2,class:"tw-text-red-500 tw-mb-4"},te={class:"tw-flex tw-flex-col tw-gap-2"},ne=E({__name:"ChangePasswordPage",setup(ae){const N=F(),_=A(),{t:b}=D(),M=G(),B=O(),v=s(""),o=s(""),m=s(""),i=s(null),p=s(!1),f=s(!1),y=s(!1),w=s(!1),g=s(null),P=s(null),d=s(!1),z=()=>{p.value=!p.value},L=()=>{f.value=!f.value},j=()=>{y.value=!y.value},S=()=>{M.back()},I=async()=>{if(i.value=null,o.value!==m.value){_.notify({type:"negative",message:"New password and confirm password do not match.",position:"top",timeout:5e3,icon:"error"}),i.value="New password and confirm password do not match.";return}try{let e;d.value?e=await N.resetPassword(P.value,g.value,o.value):e=await N.changePassword(v.value,o.value),e&&(_.notify({type:"positive",message:e,position:"top",timeout:5e3,icon:"check"}),v.value="",o.value="",m.value="",w.value=!0)}catch(e){const t=e;i.value=t.response?.data?.error||"Failed to change password. Please try again.",_.notify({type:"negative",message:i.value,position:"top",timeout:5e3,icon:"error"})}},k=e=>!!e||b("errors.validation.required"),R=e=>e.length<6?b("errors.validation.passwordMinLength",{minLength:6}):!0,U=e=>e===o.value||b("errors.validation.passwordMismatch");return $(()=>{P.value=B.query.email,g.value=B.query.token,console.log("email:",P.value,"token: ",g.value),g.value&&(d.value=!0)}),(e,t)=>{const x=H("QButton");return a(),r(X,{padding:"",class:"!tw-pb-16 !tw-px-3 tw-flex tw-justify-center tw-items-center"},{default:l(()=>[h("div",Y,[n(J,{flat:"",bordered:"",class:"!tw-w-full !tw-max-w-54 tw-p-4 !tw-bg-transparent"},{default:l(()=>[h("h4",Z,C(d.value?"Reset Password":"Change Password"),1),n(W,{class:"!tw-w-full",onSubmit:K(I,["prevent"])},{default:l(()=>[w.value?(a(),r(q,{key:0},{default:l(()=>[h("div",ee,C(d.value?"Successfully reset password!":"Successfully changed password!"),1)]),_:1})):u("",!0),w.value?u("",!0):(a(),r(q,{key:1,class:"tw-flex tw-flex-col tw-gap-4 tw-w-full !tw-p-0 tw-mb-4"},{default:l(()=>[d.value?u("",!0):(a(),r(V,{key:0,modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=c=>v.value=c),type:p.value?"text":"password",label:"Current Password",dense:"","lazy-rules":"",rules:[k,R],class:"tw-w-full"},{append:l(()=>[n(Q,{name:p.value?"visibility_off":"visibility",onClick:z},null,8,["name"])]),_:1},8,["modelValue","type","rules"])),n(V,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=c=>o.value=c),type:f.value?"text":"password",label:"New Password",dense:"","lazy-rules":"",rules:[k,R],class:"tw-w-full"},{append:l(()=>[n(Q,{name:f.value?"visibility_off":"visibility",onClick:L},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),n(V,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=c=>m.value=c),type:y.value?"text":"password",label:"Confirm New Password",dense:"","lazy-rules":"",rules:[k,U],class:"tw-w-full"},{append:l(()=>[n(Q,{name:y.value?"visibility_off":"visibility",onClick:j},null,8,["name"])]),_:1},8,["modelValue","type","rules"])]),_:1})),i.value?(a(),T("div",se,C(i.value),1)):u("",!0),h("div",te,[w.value?u("",!0):(a(),r(x,{key:0,type:"submit",label:d.value?"Reset Password":"Change Password",class:"!tw-w-full !tw-py-2.5"},null,8,["label"])),w.value?u("",!0):(a(),r(x,{key:1,secondary:"",label:"Cancel",class:"!tw-w-full !tw-py-2.5",onClick:S})),w.value?(a(),r(x,{key:2,secondary:"",label:"Go Back",class:"!tw-w-full !tw-py-2.5",onClick:S})):u("",!0)])]),_:1})]),_:1})])]),_:1})}}});export{ne as default};
