import{Q as V,f as v}from"./currency-bUyDJqco.js";import{U as W,I as E,aG as M,ad as D,ab as F,ac as R,ae as z,aH as G,r as H,l as k,e as L,aI as O,V as f,W as X,X as g,_ as o,a6 as Y,a0 as p,Y as n,$ as r,aj as w,Z,a1 as C,a3 as q,a5 as I,ak as J,a4 as K}from"./index-leGE0g0m.js";import{Q as tt}from"./QPage-NnNM1vNQ.js";import{u as et}from"./products-a2ljZtlI.js";import"./rates-CgqfOzKk.js";const st={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},at={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ot={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},it={class:"tw-flex tw-justify-start tw-gap-2"},ct={class:"tw-text-sm tw-mb-2"},rt={class:"tw-text-xs"},lt={class:"text-caption q-mt-sm"},nt={class:"q-mt-sm text-bold price-text"},dt={class:"text-grey"},ut={class:"text-positive q-ml-sm"},pt={class:"row justify-center q-mt-xl"},_t=W({__name:"SingleProductPage",setup(mt){const $=E("scrollToTop"),d="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),u=new Map,Q=M(),h=D(),c=F(),S=R(),{t:T}=z(),y=et(),P=G(),t=H({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),_=k(()=>c.dark.isActive?"white":"black"),x=k(()=>c.dark.isActive?"black":"white"),m=e=>{if(!e)return"/assets/placeholder.webp";const s=u.get(e);if(s)return s;if(e.startsWith("/static")){const i=`${d}${e}`;return u.set(e,i),i}return e.startsWith("http")&&u.set(e,e),e},U=e=>{const s=[{src:m(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const i=t.value.additionalImages.map(l=>({src:m(l),name:t.value.name||t.value.title||""}));s.push(...i)}P.openPreview(s)},j=e=>{S.addItem({...e,quantity:1}),$(),c.notify({color:"positive",position:"top",timeout:1e3,message:T("singleProduct.itemAdded"),icon:"check_circle"})},B=()=>{h.push("/products")},A=async()=>{const{slug:e}=Q.params;c.loading.show();try{const s=y.getCache("viewed");if(s){const b=s.products.find(N=>N.id===Number(e));if(b){t.value=b;return}}const i=d.endsWith("/products")?d.slice(0,-9):d,l=await fetch(`${i}/products/${e}`);if(!l.ok)throw new Error(`API returned ${l.status}`);const a=(await l.json()).data;t.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},y.setCache([t.value],"viewed")}catch(s){console.warn("Error fetching product:",s),c.notify({color:"negative",position:"top",timeout:1e3,message:"Failed to fetch product details.",icon:"error"}),t.value.id||h.push("/products")}finally{c.loading.hide()}};return L(async()=>{await A()}),O(()=>{u.clear()}),(e,s)=>(f(),X(tt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:g(()=>[o("div",st,[o("div",{class:Y(["row items-stretch full-height",{"col-reverse-md":p(c).screen.md}])},[o("div",at,[n(V,{src:m(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:s[0]||(s[0]=i=>U(t.value.image))},null,8,["src","alt"])]),o("div",ot,[n(Z,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:g(()=>[o("h5",it,[o("span",null,r(t.value.name||t.value.title),1),o("span",ct,[w("("+r(t.value.quantity)+" ",1),o("span",rt,r(e.$t("singleProduct.quantity")),1),s[2]||(s[2]=w(")"))])]),o("div",lt,r(t.value.description),1)]),_:1}),n(K,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:g(()=>[o("div",nt,[t.value.discount?(f(),C(q,{key:0},[o("s",dt,r(p(v)(t.value.price)),1),o("span",ut,r(p(v)(t.value.discountedPrice||t.value.price)),1)],64)):(f(),C(q,{key:1},[w(r(p(v)(t.value.price)),1)],64))]),n(I,{color:_.value,"text-color":x.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:s[1]||(s[1]=J(i=>j(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",pt,[n(I,{color:_.value,"text-color":x.value,label:e.$t("singleProduct.backToProducts"),onClick:B},null,8,["color","text-color","label"])])]),_:1}))}});export{_t as default};
