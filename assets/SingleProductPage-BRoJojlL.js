import{Q as z}from"./QImg-RQubfyKJ.js";import{c as h,a1 as G,aT as u,z as H,y as O,aU as B,aV as x,d as W,a4 as X,aW as Y,al as J,aj as K,ak as Z,ab as tt,aX as et,q as at,aY as ot,A as st,o as d,a as S,w as b,f as s,n as it,g as m,h as k,t as c,e as g,ag as P,Q as lt,F as U,k as A,aG as ct,j as nt,aN as f}from"./index-BMBcM2NY.js";import{Q as rt}from"./QPage-CDuXREek.js";import{f as C}from"./currency-Dlv5CAeD.js";import{u as ut}from"./products-DGzB295l.js";import{api as dt}from"./axios-DDgxsM5n.js";import"./rates-CrAQkhvh.js";function j(p){{const i={active:!0};if(typeof p=="function"){const r=h(p);i.val=r.value,G(r,v=>{i.val=v,i.active===!0&&u()})}else i.val=p;x.push(i),u(),H(()=>{i.active=!0,u()}),O(()=>{i.active=!1,u()}),B(()=>{x.splice(x.indexOf(i),1),u()})}}const mt={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},pt={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},vt={key:0},gt={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},ft={class:"tw-flex tw-justify-start tw-gap-2"},ht={class:"tw-text-sm tw-mb-2"},wt={class:"tw-text-xs"},yt={class:"text-caption q-mt-sm"},_t={class:"q-mt-sm text-bold price-text"},xt={class:"text-grey"},bt={class:"text-positive q-ml-sm"},kt={class:"row justify-center q-mt-xl"},St=W({__name:"SingleProductPage",setup(p){const i=X("scrollToTop"),r="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),v=new Map,N=Y(),w=J(),n=K(),V=Z(),{t:y}=tt(),q=ut(),E=et(),t=at({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),T=h(()=>n.dark.isActive?"white":"black"),$=h(()=>n.dark.isActive?"black":"white"),I=h(()=>`${t.value.name||t.value.title} - ${ot}`),_=o=>{const e=`${r}${o}`;console.log("imagePath:",o,"fullUrl:",e);const l=v.get(e);return l||e},D=o=>{const e=[{src:_(o),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const l=t.value.additionalImages.map(a=>({src:_(a),name:t.value.name||t.value.title||""}));e.push(...l)}E.openPreview(e)},M=o=>{V.addItem({...o,quantity:1}),i(),n.notify({color:"positive",position:"top",timeout:1e3,message:y("singleProduct.itemAdded"),icon:"check_circle"})},F=()=>{w.push(f)},L=async()=>{const{slug:o}=N.params;n.loading.show();try{const e=q.getViewedCache();if(e){const Q=e.products.find(R=>R.id===Number(o));if(Q){t.value=Q,j({title:I.value});return}}const l=await dt.get(`${r}${f}/${o}`);if(t.value.id||w.push(f),l.status!==200)throw new Error("Failed to fetch product");const{data:a}=l.data;t.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},q.setViewedCache(t.value),j({title:I.value})}catch(e){console.warn("Error fetching product:",e),n.notify({color:"negative",position:"top",timeout:1e3,message:y("errors.fetchProduct"),icon:"error"}),t.value.id||w.push(f)}finally{n.loading.hide()}};return st(async()=>{await L()}),B(()=>{v.clear()}),(o,e)=>(d(),S(rt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:b(()=>[s("div",mt,[s("div",{class:it(["row items-stretch full-height",{"col-reverse-md":m(n).screen.md}])},[s("div",pt,[t.value.image?(d(),S(z,{key:1,src:_(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:e[0]||(e[0]=l=>D(t.value.image))},null,8,["src","alt"])):(d(),k("div",vt,c(m(y)("errors.noImage")),1))]),s("div",gt,[g(lt,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:b(()=>[s("h5",ft,[s("span",null,c(t.value.name||t.value.title),1),s("span",ht,[P("("+c(t.value.quantity)+" ",1),s("span",wt,c(o.$t("singleProduct.quantity")),1),e[2]||(e[2]=P(")"))])]),s("div",yt,c(t.value.description),1)]),_:1}),g(nt,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:b(()=>[s("div",_t,[t.value.discount?(d(),k(U,{key:0},[s("s",xt,c(m(C)(t.value.price)),1),s("span",bt,c(m(C)(t.value.discountedPrice||t.value.price)),1)],64)):(d(),k(U,{key:1},[P(c(m(C)(t.value.price)),1)],64))]),g(A,{color:T.value,"text-color":$.value,label:o.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:e[1]||(e[1]=ct(l=>M(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),s("div",kt,[g(A,{color:T.value,"text-color":$.value,label:o.$t("singleProduct.backToProducts"),onClick:F},null,8,["color","text-color","label"])])]),_:1}))}});export{St as default};
