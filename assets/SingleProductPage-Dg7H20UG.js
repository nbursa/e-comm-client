import{Q as W,f as h}from"./currency-BLywnJ27.js";import{q as b,I as R,aI as d,a as z,o as F,aJ as B,aK as w,W as J,L as K,aL as X,af as Y,ad as Z,ae as G,ag as H,aM as O,r as tt,e as et,X as y,Y as at,Z as x,a0 as o,a8 as st,a2 as f,_ as p,a1 as n,al as _,$ as ot,a3 as P,a5 as Q,a7 as T,am as it,a6 as ct}from"./index-CmGsZ9Jx.js";import{Q as lt}from"./QPage-Ou6qXcnW.js";import{u as nt}from"./products-BLrY7T2W.js";import"./rates-DmiuTxy7.js";function A(m){{const i={active:!0};if(typeof m=="function"){const u=b(m);i.val=u.value,R(u,r=>{i.val=r,i.active===!0&&d()})}else i.val=m;w.push(i),d(),z(()=>{i.active=!0,d()}),F(()=>{i.active=!1,d()}),B(()=>{w.splice(w.indexOf(i),1),d()})}}const rt={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},ut={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},dt={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},pt={class:"tw-flex tw-justify-start tw-gap-2"},mt={class:"tw-text-sm tw-mb-2"},vt={class:"tw-text-xs"},ft={class:"text-caption q-mt-sm"},gt={class:"q-mt-sm text-bold price-text"},ht={class:"text-grey"},wt={class:"text-positive q-ml-sm"},yt={class:"row justify-center q-mt-xl"},qt=J({__name:"SingleProductPage",setup(m){const i=K("scrollToTop"),u="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),r=new Map,U=X(),C=Y(),l=Z(),j=G(),{t:k}=H(),q=nt(),E=O(),t=tt({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),$=b(()=>l.dark.isActive?"white":"black"),I=b(()=>l.dark.isActive?"black":"white"),g=e=>{if(!e)return"/assets/placeholder.webp";const a=r.get(e);if(a)return a;if(e.startsWith("/static")){const c=`${u}${e}`;return r.set(e,c),c}return e.startsWith("http")&&r.set(e,e),e},M=e=>{const a=[{src:g(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const c=t.value.additionalImages.map(S=>({src:g(S),name:t.value.name||t.value.title||""}));a.push(...c)}E.openPreview(a)},N=e=>{j.addItem({...e,quantity:1}),i(),l.notify({color:"positive",position:"top",timeout:1e3,message:k("singleProduct.itemAdded"),icon:"check_circle"})},V=()=>{C.push("/products")},L=async()=>{const{slug:e}=U.params;l.loading.show();try{const a=q.getViewedCache();if(a){const v=a.products.find(D=>D.id===Number(e));if(v){t.value=v,A({title:`${v.name||v.title} - E-Comm Shop`});return}}const c=await fetch(`${u}/products/${e}`);if(!c.ok)throw new Error(`API returned ${c.status}`);const s=(await c.json()).data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},q.setViewedCache(t.value),A({title:`${t.value.name||t.value.title} - E-Comm Shop`})}catch(a){console.warn("Error fetching product:",a),l.notify({color:"negative",position:"top",timeout:1e3,message:k("errors.fetchProduct"),icon:"error"}),t.value.id||C.push("/products")}finally{l.loading.hide()}};return et(async()=>{await L()}),B(()=>{r.clear()}),(e,a)=>(y(),at(lt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:x(()=>[o("div",rt,[o("div",{class:st(["row items-stretch full-height",{"col-reverse-md":f(l).screen.md}])},[o("div",ut,[p(W,{src:g(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:a[0]||(a[0]=c=>M(t.value.image))},null,8,["src","alt"])]),o("div",dt,[p(ot,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:x(()=>[o("h5",pt,[o("span",null,n(t.value.name||t.value.title),1),o("span",mt,[_("("+n(t.value.quantity)+" ",1),o("span",vt,n(e.$t("singleProduct.quantity")),1),a[2]||(a[2]=_(")"))])]),o("div",ft,n(t.value.description),1)]),_:1}),p(ct,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:x(()=>[o("div",gt,[t.value.discount?(y(),P(Q,{key:0},[o("s",ht,n(f(h)(t.value.price)),1),o("span",wt,n(f(h)(t.value.discountedPrice||t.value.price)),1)],64)):(y(),P(Q,{key:1},[_(n(f(h)(t.value.price)),1)],64))]),p(T,{color:$.value,"text-color":I.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:a[1]||(a[1]=it(c=>N(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",yt,[p(T,{color:$.value,"text-color":I.value,label:e.$t("singleProduct.backToProducts"),onClick:V},null,8,["color","text-color","label"])])]),_:1}))}});export{qt as default};
