import{Q as G}from"./QImg-DpZaWHSc.js";import{c as v,a1 as H,aT as d,z as O,y as W,aU as B,aV as y,d as X,a4 as Y,aW as J,al as K,aj as Z,ak as ee,ab as te,aX as ae,q as oe,aY as se,A as ie,o as m,a as Q,w as _,f as s,n as le,g as p,h as x,t as c,e as f,ag as b,Q as ce,F as S,k as A,aG as ne,j as re,aN as k}from"./index-D1MEv7fW.js";import{Q as ue}from"./QPage-8Ghxx28H.js";import{f as C}from"./currency-a6-8zrJW.js";import{u as de}from"./products-CPD7Qu8v.js";import{api as me}from"./axios-ChdTr73M.js";import"./rates-oDA6Sp9s.js";function j(g){{const i={active:!0};if(typeof g=="function"){const r=v(g);i.val=r.value,H(r,u=>{i.val=u,i.active===!0&&d()})}else i.val=g;y.push(i),d(),O(()=>{i.active=!0,d()}),W(()=>{i.active=!1,d()}),B(()=>{y.splice(y.indexOf(i),1),d()})}}const pe={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},ve={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ge={key:0},fe={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},he={class:"tw-flex tw-justify-start tw-gap-2"},we={class:"tw-text-sm tw-mb-2"},ye={class:"tw-text-xs"},_e={class:"text-caption q-mt-sm"},xe={class:"q-mt-sm text-bold price-text"},be={class:"text-grey"},ke={class:"text-positive q-ml-sm"},Ce={class:"row justify-center q-mt-xl"},Se=X({__name:"SingleProductPage",setup(g){const i=Y("scrollToTop"),r="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),u=new Map,N=J(),P=K(),n=Z(),V=ee(),{t:h}=te(),q=de(),E=ae(),e=oe({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),I=v(()=>n.dark.isActive?"white":"black"),T=v(()=>n.dark.isActive?"black":"white"),$=v(()=>`${e.value.name||e.value.title} - ${se}`),w=o=>{if(!o)return"";const t=`${r}${o}`;console.log("imagePath:",o,"fullUrl:",t);const l=u.get(t);return l||(u.set(t,t),t)},D=v(()=>e.value?.image?w(e.value.image):""),M=o=>{const t=[{src:w(o),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const l=e.value.additionalImages.map(a=>({src:w(a),name:e.value.name||e.value.title||""}));t.push(...l)}E.openPreview(t)},F=o=>{V.addItem({...o,quantity:1}),i(),n.notify({color:"positive",position:"top",timeout:1e3,message:h("singleProduct.itemAdded"),icon:"check_circle"})},L=()=>{P.push(k)},R=async()=>{const{slug:o}=N.params;n.loading.show();try{const t=q.getViewedCache();if(t){const U=t.products.find(z=>z.id===Number(o));if(U){e.value=U,j({title:$.value});return}}const l=await me.get(`${r}${k}/${o}`);if(l.status!==200)throw new Error("Failed to fetch product");const{data:a}=l.data;e.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},q.setViewedCache(e.value),j({title:$.value})}catch(t){console.warn("Error fetching product:",t),n.notify({color:"negative",position:"top",timeout:1e3,message:h("errors.fetchProduct"),icon:"error"}),e.value.id||P.push(k)}finally{n.loading.hide()}};return ie(()=>{R()}),B(()=>{u.clear()}),(o,t)=>(m(),Q(ue,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:_(()=>[s("div",pe,[s("div",{class:le(["row items-stretch full-height",{"col-reverse-md":p(n).screen.md}])},[s("div",ve,[e.value.image?(m(),Q(G,{key:1,src:D.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:t[0]||(t[0]=l=>M(e.value.image))},null,8,["src","alt"])):(m(),x("div",ge,c(p(h)("errors.noImage")),1))]),s("div",fe,[f(ce,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:_(()=>[s("h5",he,[s("span",null,c(e.value.name||e.value.title),1),s("span",we,[b("("+c(e.value.quantity)+" ",1),s("span",ye,c(o.$t("singleProduct.quantity")),1),t[2]||(t[2]=b(")"))])]),s("div",_e,c(e.value.description),1)]),_:1}),f(re,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:_(()=>[s("div",xe,[e.value.discount?(m(),x(S,{key:0},[s("s",be,c(p(C)(e.value.price)),1),s("span",ke,c(p(C)(e.value.discountedPrice||e.value.price)),1)],64)):(m(),x(S,{key:1},[b(c(p(C)(e.value.price)),1)],64))]),f(A,{color:I.value,"text-color":T.value,label:o.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:t[1]||(t[1]=ne(l=>F(e.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),s("div",Ce,[f(A,{color:I.value,"text-color":T.value,label:o.$t("singleProduct.backToProducts"),onClick:L},null,8,["color","text-color","label"])])]),_:1}))}});export{Se as default};
