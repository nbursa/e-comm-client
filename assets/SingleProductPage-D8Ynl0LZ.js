import{Q as z}from"./QImg-Co9yavjM.js";import{c as v,a1 as G,aT as d,z as H,y as O,aU as B,aV as x,d as X,a4 as Y,aW as J,al as K,aj as Z,ak as tt,ab as et,aX as at,q as st,aY as ot,A as it,o as m,a as Q,w as b,f as o,n as lt,g as p,h as k,t as c,e as g,ag as C,Q as ct,F as S,k as A,aG as nt,j as rt,aN as h}from"./index-KkaQKGoN.js";import{Q as ut}from"./QPage-Bk_xBASy.js";import{f as q}from"./currency-55oz4xQf.js";import{u as dt}from"./products-CEW5-co3.js";import{api as mt}from"./axios-Dqbd-SmO.js";import"./rates-Bcyw_Nsm.js";function j(f){{const i={active:!0};if(typeof f=="function"){const u=v(f);i.val=u.value,G(u,n=>{i.val=n,i.active===!0&&d()})}else i.val=f;x.push(i),d(),H(()=>{i.active=!0,d()}),O(()=>{i.active=!1,d()}),B(()=>{x.splice(x.indexOf(i),1),d()})}}const pt={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},vt={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},ft={key:0},gt={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},ht={class:"tw-flex tw-justify-start tw-gap-2"},wt={class:"tw-text-sm tw-mb-2"},yt={class:"tw-text-xs"},_t={class:"text-caption q-mt-sm"},xt={class:"q-mt-sm text-bold price-text"},bt={class:"text-grey"},kt={class:"text-positive q-ml-sm"},Ct={class:"row justify-center q-mt-xl"},St=X({__name:"SingleProductPage",setup(f){const i=Y("scrollToTop"),u="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),n=new Map,N=J(),w=K(),r=Z(),V=tt(),{t:y}=et(),I=dt(),E=at(),t=st({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),T=v(()=>r.dark.isActive?"white":"black"),$=v(()=>r.dark.isActive?"black":"white"),P=v(()=>`${t.value.name||t.value.title} - ${ot}`),D=v(()=>t.value?.image?_(t.value.image):""),_=a=>{if(!a)return"";const e=`${u}${a}`;console.log("imagePath:",a,"fullUrl:",e);const l=n.get(e);return l||(a.startsWith("/static")?(n.set(e,e),e):a.startsWith("http")?(n.set(a,a),a):(n.set(e,e),e))},M=a=>{const e=[{src:_(a),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const l=t.value.additionalImages.map(s=>({src:_(s),name:t.value.name||t.value.title||""}));e.push(...l)}E.openPreview(e)},F=a=>{V.addItem({...a,quantity:1}),i(),r.notify({color:"positive",position:"top",timeout:1e3,message:y("singleProduct.itemAdded"),icon:"check_circle"})},L=()=>{w.push(h)},R=async()=>{const{slug:a}=N.params;r.loading.show();try{const e=I.getViewedCache();if(e){const U=e.products.find(W=>W.id===Number(a));if(U){t.value=U,j({title:P.value});return}}const l=await mt.get(`${u}${h}/${a}`);if(t.value.id||w.push(h),l.status!==200)throw new Error("Failed to fetch product");const{data:s}=l.data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},I.setViewedCache(t.value),j({title:P.value})}catch(e){console.warn("Error fetching product:",e),r.notify({color:"negative",position:"top",timeout:1e3,message:y("errors.fetchProduct"),icon:"error"}),t.value.id||w.push(h)}finally{r.loading.hide()}};return it(async()=>{await R()}),B(()=>{n.clear()}),(a,e)=>(m(),Q(ut,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:b(()=>[o("div",pt,[o("div",{class:lt(["row items-stretch full-height",{"col-reverse-md":p(r).screen.md}])},[o("div",vt,[t.value.image?(m(),Q(z,{key:1,src:D.value,alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:e[0]||(e[0]=l=>M(t.value.image))},null,8,["src","alt"])):(m(),k("div",ft,c(p(y)("errors.noImage")),1))]),o("div",gt,[g(ct,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:b(()=>[o("h5",ht,[o("span",null,c(t.value.name||t.value.title),1),o("span",wt,[C("("+c(t.value.quantity)+" ",1),o("span",yt,c(a.$t("singleProduct.quantity")),1),e[2]||(e[2]=C(")"))])]),o("div",_t,c(t.value.description),1)]),_:1}),g(rt,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:b(()=>[o("div",xt,[t.value.discount?(m(),k(S,{key:0},[o("s",bt,c(p(q)(t.value.price)),1),o("span",kt,c(p(q)(t.value.discountedPrice||t.value.price)),1)],64)):(m(),k(S,{key:1},[C(c(p(q)(t.value.price)),1)],64))]),g(A,{color:T.value,"text-color":$.value,label:a.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:e[1]||(e[1]=nt(l=>F(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",Ct,[g(A,{color:T.value,"text-color":$.value,label:a.$t("singleProduct.backToProducts"),onClick:L},null,8,["color","text-color","label"])])]),_:1}))}});export{St as default};
