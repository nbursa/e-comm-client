import{Q as D,f as w}from"./currency-CO-E7HGI.js";import{q as C,I as R,aI as p,a as z,o as F,aJ as A,aK as y,W as J,L as K,aL as X,af as Y,ad as Z,ae as G,ag as H,aM as O,r as tt,e as et,X as x,Y as at,Z as _,a0 as o,a8 as st,a2 as h,_ as m,a1 as r,al as b,$ as ot,a3 as P,a5 as Q,a7 as T,am as it,a6 as ct}from"./index-DU6EdHr2.js";import{Q as lt}from"./QPage-Bb2PkgGk.js";import{u as nt}from"./products-D-N0tHYQ.js";import"./rates-CIvl6D6l.js";function U(v){{const i={active:!0};if(typeof v=="function"){const l=C(v);i.val=l.value,R(l,u=>{i.val=u,i.active===!0&&p()})}else i.val=v;y.push(i),p(),z(()=>{i.active=!0,p()}),F(()=>{i.active=!1,p()}),A(()=>{y.splice(y.indexOf(i),1),p()})}}const rt={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},ut={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},dt={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},pt={class:"tw-flex tw-justify-start tw-gap-2"},mt={class:"tw-text-sm tw-mb-2"},vt={class:"tw-text-xs"},ft={class:"text-caption q-mt-sm"},ht={class:"q-mt-sm text-bold price-text"},gt={class:"text-grey"},wt={class:"text-positive q-ml-sm"},yt={class:"row justify-center q-mt-xl"},$t=J({__name:"SingleProductPage",setup(v){const i=K("scrollToTop"),l="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),u=new Map,B=X(),k=Y(),n=Z(),j=G(),{t:q}=H(),$=nt(),E=O(),t=tt({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),I=C(()=>n.dark.isActive?"white":"black"),S=C(()=>n.dark.isActive?"black":"white"),g=e=>{if(!e)return"/assets/placeholder.webp";const a=u.get(e);if(a)return a;if(e.startsWith("/static")){const c=`${l}${e}`;return u.set(e,c),c}return e.startsWith("http")&&u.set(e,e),e},M=e=>{const a=[{src:g(e),name:t.value.name||t.value.title||""}];if(t.value.additionalImages?.length){const c=t.value.additionalImages.map(d=>({src:g(d),name:t.value.name||t.value.title||""}));a.push(...c)}E.openPreview(a)},N=e=>{j.addItem({...e,quantity:1}),i(),n.notify({color:"positive",position:"top",timeout:1e3,message:q("singleProduct.itemAdded"),icon:"check_circle"})},V=()=>{k.push("/products")},L=async()=>{const{slug:e}=B.params;n.loading.show();try{const a=$.getViewedCache();if(a){const f=a.products.find(W=>W.id===Number(e));if(f){t.value=f,U({title:`${f.name||f.title} - E-Comm Shop`});return}}const c=l.endsWith("/products")?l.slice(0,-9):l,d=await fetch(`${c}/products/${e}`);if(!d.ok)throw new Error(`API returned ${d.status}`);const s=(await d.json()).data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},$.setViewedCache(t.value),U({title:`${t.value.name||t.value.title} - E-Comm Shop`})}catch(a){console.warn("Error fetching product:",a),n.notify({color:"negative",position:"top",timeout:1e3,message:q("errors.fetchProduct"),icon:"error"}),t.value.id||k.push("/products")}finally{n.loading.hide()}};return et(async()=>{await L()}),A(()=>{u.clear()}),(e,a)=>(x(),at(lt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:_(()=>[o("div",rt,[o("div",{class:st(["row items-stretch full-height",{"col-reverse-md":h(n).screen.md}])},[o("div",ut,[m(D,{src:g(t.value.image),alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:a[0]||(a[0]=c=>M(t.value.image))},null,8,["src","alt"])]),o("div",dt,[m(ot,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:_(()=>[o("h5",pt,[o("span",null,r(t.value.name||t.value.title),1),o("span",mt,[b("("+r(t.value.quantity)+" ",1),o("span",vt,r(e.$t("singleProduct.quantity")),1),a[2]||(a[2]=b(")"))])]),o("div",ft,r(t.value.description),1)]),_:1}),m(ct,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:_(()=>[o("div",ht,[t.value.discount?(x(),P(Q,{key:0},[o("s",gt,r(h(w)(t.value.price)),1),o("span",wt,r(h(w)(t.value.discountedPrice||t.value.price)),1)],64)):(x(),P(Q,{key:1},[b(r(h(w)(t.value.price)),1)],64))]),m(T,{color:I.value,"text-color":S.value,label:e.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:a[1]||(a[1]=it(c=>N(t.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),o("div",yt,[m(T,{color:I.value,"text-color":S.value,label:e.$t("singleProduct.backToProducts"),onClick:V},null,8,["color","text-color","label"])])]),_:1}))}});export{$t as default};
