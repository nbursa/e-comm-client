import{p as K,$ as W,a0 as ee,c as d,v as _,V as A,A as te,S as ae,aX as f,a6 as se,a5 as oe,aY as ne,aZ as B,d as ie,X as le,a_ as ce,am as re,ak as ue,al as de,ab as me,a$ as pe,x as k,b0 as ve,a7 as we,o as u,a as fe,w as q,h as p,e as v,b1 as ge,f as n,t as c,n as V,g,ac as Q,Q as he,F as E,k as N,ae as M,j as ye,aR as R}from"./index-BNDOQhhJ.js";import{Q as xe}from"./QImg-CDkIIBhS.js";import{Q as be}from"./QPage-C6YMGbH2.js";import{f as S}from"./currency-o5dVYT28.js";import{u as _e}from"./products-D0S_5D7h.js";import{api as ke}from"./axios-BO-518Fi.js";import"./rates-Bk2Yzsb7.js";const qe=K({name:"QBanner",props:{...W,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:o}){const{proxy:{$q:m}}=te(),w=ee(i,m),h=d(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(w.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),l=d(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const y=[_("div",{class:"q-banner__avatar col-auto row items-center self-start"},A(o.avatar)),_("div",{class:"q-banner__content col text-body2"},A(o.default))],r=A(o.action);return r!==void 0&&y.push(_("div",{class:l.value},r)),_("div",{class:h.value+(i.inlineActions===!1&&r!==void 0?" q-banner--top-padding":""),role:"alert"},y)}}});function Ce(i){{const o={active:!0};if(typeof i=="function"){const m=d(i);o.val=m.value,ae(m,w=>{o.val=w,o.active===!0&&f()})}else o.val=i;B.push(o),f(),se(()=>{o.active=!0,f()}),oe(()=>{o.active=!1,f()}),ne(()=>{B.splice(B.indexOf(o),1),f()})}}const Ie={key:0,class:"q-pa-md"},Pe={key:1,class:"q-pa-md"},$e={key:2,class:"q-mb-md q-mx-auto !tw-w-full row items-stretch justify-center",style:{"max-width":"1200px"}},Ae={class:"col-12 col-sm-6 col-md-4 tw-px-2 sm:tw-px-0 tw-transition tw-duration-500 tw-ease-in-out hover:tw-scale-105"},Be={key:1,class:"tw-h-full tw-w-full"},Qe={class:"col-12 col-sm-6 col-md-8 sm:tw-px-3 sm:!tw-py-0 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},Se={class:"tw-flex tw-justify-between tw-gap-2"},Te={class:"tw-text-base md:tw-text-xl"},Ue={class:"tw-text-sm tw-mb-2"},je={class:"tw-text-xs"},De={class:"text-caption q-mt-sm"},Ve={class:"text-bold price-text tw-pb-3"},Ee={class:"text-grey"},Ne={class:"text-positive q-ml-sm"},Me={class:"tw-w-full tw-flex tw-justify-between tw-gap-4"},Oe=ie({__name:"SingleProductPage",setup(i){const o=le("scrollToTop"),m="https://e-comm-api-8eba0f6c8782.herokuapp.com/api".replace(/\/$/,""),w=ce(),h=re(),l=ue(),y=de(),{t:r}=me(),C=_e(),F=pe(),{slug:T}=w.params,e=k({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=k(!0),I=k(null),P=k(new Map),U=d(()=>l.dark.isActive),j=d(()=>l.dark.isActive?"white":"black"),D=d(()=>l.dark.isActive?"black":"white"),L=d(()=>`${e.value.name||e.value.title} - ${ve}`),z=s=>{if(!P.value.has(s)){const t=new Image;t.src=s,t.onload=()=>{P.value.set(s,t)}}},X=s=>{const t=P.value.get(s);return t?t.src:s},$=s=>{if(!s)return"";const t=`${m}${s}`,a=X(t);return a||(z(t),t)},G=d(()=>e.value?.image?$(e.value.image):""),H=s=>{const t=[{src:$(s),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const a=e.value.additionalImages.map(b=>({src:$(b),name:e.value.name||e.value.title||""}));t.push(...a)}F.openPreview(t)},O=s=>{y.addItem({...s,quantity:1}),o(),l.notify({color:"positive",position:"top",timeout:1e3,message:r("singleProduct.itemAdded"),icon:"check_circle"})},Y=()=>{h.back()},Z=async()=>{x.value=!0,l.loading.show();try{C.initViewedCache();const s=C.getViewedCache();if(s){const b=s.products.find(J=>J.id===Number(T));if(b){e.value=b,x.value=!1;return}}const t=await ke.get(`${m}${R}/${T}`);if(t.status!==200)throw new Error("Failed to fetch product");const{data:a}=t.data;e.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},C.setViewedCache(e.value)}catch(s){console.warn("Error fetching product:",s),I.value=r("errors.fetchProduct"),l.notify({color:"negative",position:"top",timeout:1e3,message:r("errors.fetchProduct"),icon:"error"}),e.value.id||h.push(R)}finally{l.loading.hide(),x.value=!1}};return we(()=>{Z(),Ce({title:L.value})}),(s,t)=>(u(),fe(be,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4"},{default:q(()=>[x.value?(u(),p("div",Ie,[v(ge,{color:"primary",size:"50px"})])):I.value?(u(),p("div",Pe,[v(qe,{type:"negative",class:"q-mb-md"},{default:q(()=>[n("div",null,c(I.value),1)]),_:1})])):(u(),p("div",$e,[n("div",{class:V(["row items-stretch full-height !tw-w-full justify-center",{"col-reverse-md":g(l).screen.sm}])},[n("div",Ae,[e.value.image?(u(),p("div",Be,[v(xe,{src:G.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height !tw-rounded-md",onClick:t[0]||(t[0]=a=>H(e.value.image))},null,8,["src","alt"])])):(u(),p("div",{key:0,class:V(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400 tw-pb-2",U.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},c(g(r)("errors.noImage")),3))]),n("div",Qe,[v(he,{class:"!tw-p-0 !tw-px-3",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:q(()=>[n("h5",Se,[n("span",Te,c(e.value.name||e.value.title),1),n("span",Ue,[Q("("+c(e.value.quantity)+" ",1),n("span",je,c(s.$t("singleProduct.quantity")),1),t[3]||(t[3]=Q(")"))])]),n("div",De,c(e.value.description),1)]),_:1}),v(ye,{align:"right",class:"row justify-between items-end !tw-px-3"},{default:q(()=>[n("div",Ve,[e.value.discount?(u(),p(E,{key:0},[n("s",Ee,c(g(S)(e.value.price)),1),n("span",Ne,c(g(S)(e.value.discountedPrice||e.value.price)),1)],64)):(u(),p(E,{key:1},[Q(c(g(S)(e.value.price)),1)],64))]),n("div",Me,[v(N,{color:D.value,"text-color":j.value,outline:U.value,label:s.$t("singleProduct.goBack"),class:"!tw-p-4 tw-flex-1 tw-basis-1/3",onClick:t[1]||(t[1]=M(a=>Y(),["stop"]))},null,8,["color","text-color","outline","label"]),v(N,{color:j.value,"text-color":D.value,label:s.$t("singleProduct.addToCart"),class:"!tw-p-4 tw-flex-1 tw-basis-2/3",onClick:t[2]||(t[2]=M(a=>O(e.value),["stop"]))},null,8,["color","text-color","label"])])]),_:1})])],2)]))]),_:1}))}});export{Oe as default};
