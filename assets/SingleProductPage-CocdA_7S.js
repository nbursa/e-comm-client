import{q as J,a0 as K,a1 as X,c as w,x as b,W as B,B as Z,U as tt,a_ as p,a7 as et,a6 as at,a$ as st,b0 as Q,d as ot,Y as nt,b1 as lt,an as ct,al as it,am as rt,ac as ut,b2 as dt,y,b3 as wt,a8 as mt,o as u,a as ft,w as k,k as f,e as d,b4 as vt,h as o,t as c,ar as pt,n as gt,j as C,ad as S,g as ht,l as xt,F as V,Q as E,aU as N}from"./index-BrpM8wxG.js";import{Q as _t}from"./QImg-CdsVYnpO.js";import{Q as bt}from"./QPage-Duuna0Um.js";import{f as T}from"./currency-DNdHl-ZD.js";import{u as yt}from"./products-Dgo9bkw8.js";import{api as kt}from"./axios-Co-nYjem.js";import"./rates-DR2RuQtv.js";const Ct=J({name:"QBanner",props:{...K,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(l,{slots:n}){const{proxy:{$q:m}}=Z(),v=X(l,m),g=w(()=>"q-banner row items-center"+(l.dense===!0?" q-banner--dense":"")+(v.value===!0?" q-banner--dark q-dark":"")+(l.rounded===!0?" rounded-borders":"")),i=w(()=>`q-banner__actions row items-center justify-end col-${l.inlineActions===!0?"auto":"all"}`);return()=>{const h=[b("div",{class:"q-banner__avatar col-auto row items-center self-start"},B(n.avatar)),b("div",{class:"q-banner__content col text-body2"},B(n.default))],r=B(n.action);return r!==void 0&&h.push(b("div",{class:i.value},r)),b("div",{class:g.value+(l.inlineActions===!1&&r!==void 0?" q-banner--top-padding":""),role:"alert"},h)}}});function It(l){{const n={active:!0};if(typeof l=="function"){const m=w(l);n.val=m.value,tt(m,v=>{n.val=v,n.active===!0&&p()})}else n.val=l;Q.push(n),p(),et(()=>{n.active=!0,p()}),at(()=>{n.active=!1,p()}),st(()=>{Q.splice(Q.indexOf(n),1),p()})}}const Pt={key:0,class:"tw-p-4"},qt={key:1,class:"tw-p-4"},$t={key:2,class:"tw-flex tw-w-full tw-mx-auto tw-flex-col tw-justify-center tw-items-center tw-gap-3",style:{"max-width":"1200px"}},Bt={class:"tw-flex tw-w-full !tw-flex-col tw-items-baseline !tw-justify-between sm:!tw-justify-start md:tw-mb-8"},Qt={class:"tw-text-3xl tw-mt-4 tw-font-semibold tw-font-serif tw-mr-4"},St={class:"tw-text-base"},Tt={class:"tw-flex !tw-flex-col !tw-w-full tw-gap-4 sm:!tw-flex-row"},Ut={class:"tw-col-span-12 sm:!tw-col-span-6 tw-w-full tw-px-0 tw-transition tw-duration-500 tw-ease-in-out hover:tw-scale-105"},At={key:1,class:"tw-h-full tw-w-full"},jt={class:"tw-col-span-12 sm:!tw-col-span-6 tw-w-full tw-flex tw-flex-col tw-flex-grow-0 tw-h-auto tw-min-h-full sm:!tw-py-0 !tw-align-top"},Dt={class:"!tw-w-full tw-flex tw-font-serif tw-justify-end tw-gap-2"},Vt={class:"tw-text-sm tw-mb-2"},Et={class:"tw-text-xs"},Nt={class:"tw-text-base"},Ft={class:"text-bold tw-text-xl tw-pb-5"},Lt={class:"tw-text-gray-500 tw-mr-1 tw-text-base tw-line-through"},Mt={class:"tw-text-green-600"},Rt={class:"tw-w-full tw-flex tw-justify-between tw-gap-4"},Kt=ot({__name:"SingleProductPage",setup(l){const n=nt("scrollToTop"),m="https://e-comm-api-8eba0f6c8782.herokuapp.com/api".replace(/\/$/,""),v=lt(),g=ct(),i=it(),h=rt(),{t:r}=ut(),I=yt(),F=dt(),{slug:U}=v.params,t=y(null),x=y(!0),P=y(null),q=y(new Map),A=w(()=>i.dark.isActive),j=w(()=>i.dark.isActive?"white":"black"),D=w(()=>i.dark.isActive?"black":"white"),L=w(()=>`${t.value?.name||t.value?.title||""} - ${wt}`),M=a=>{if(!q.value.has(a)){const e=new Image;e.src=a,e.onload=()=>{q.value.set(a,e)}}},R=a=>{const e=q.value.get(a);return e?e.src:a},$=a=>{if(!a)return"";const e=`${m}${a}`,s=R(e);return s||(M(e),e)},z=w(()=>t.value?.image?$(t.value.image):""),G=a=>{const e=[{src:$(a),name:t.value?.name||t.value?.title||""}];if(t.value&&t.value.additionalImages?.length){const s=t.value.additionalImages.map(_=>({src:$(_),name:t.value&&(t.value.name||t.value.title)||""}));e.push(...s)}F.openPreview(e)},H=a=>{h.addItem({...a,quantity:1}),n(),i.notify({color:"positive",position:"top",timeout:1e3,message:r("singleProduct.itemAdded"),icon:"check_circle"})},O=()=>{g.back()},W=async()=>{x.value=!0,i.loading.show();try{I.initViewedCache();const a=I.getViewedCache();if(a){const _=a.products.find(Y=>Y.id===Number(U));if(_){t.value=_,x.value=!1;return}}const e=await kt.get(`${m}${N}/${U}`);if(e.status!==200)throw new Error("Failed to fetch product");const{data:s}=e.data;t.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},I.setViewedCache(t.value)}catch(a){console.warn("Error fetching product:",a),P.value=r("errors.fetchProduct"),i.notify({color:"negative",position:"top",timeout:1e3,message:r("errors.fetchProduct"),icon:"error"}),(!t.value||!t.value.id)&&g.push(N)}finally{i.loading.hide(),x.value=!1}};return mt(()=>{W(),It({title:L.value})}),(a,e)=>(u(),ft(bt,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4 !tw-px-3"},{default:k(()=>[x.value?(u(),f("div",Pt,[d(vt,{color:"primary",size:"50px"})])):P.value?(u(),f("div",qt,[d(Ct,{type:"negative",class:"q-mb-md"},{default:k(()=>[o("div",null,c(P.value),1)]),_:1})])):(u(),f("div",$t,[o("div",Bt,[o("span",Qt,c(t.value?.name),1),o("span",St,c(t.value?.category),1)]),d(pt),o("div",Tt,[o("div",Ut,[t.value?.image?(u(),f("div",At,[d(_t,{src:z.value,alt:t.value.name,fit:"contain",class:"cursor-pointer full-width full-height !tw-rounded-md",onClick:e[0]||(e[0]=s=>G(t.value.image))},null,8,["src","alt"])])):(u(),f("div",{key:0,class:gt(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400 tw-pb-2",A.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},c(C(r)("errors.noImage")),3))]),o("div",jt,[o("h5",Dt,[o("span",Vt,[S("("+c(t.value?.quantity)+" ",1),o("span",Et,c(a.$t("singleProduct.quantity")),1),e[2]||(e[2]=S(")"))])]),d(ht,{class:"tw-flex tw-flex-col tw-flex-1 tw-h-full !tw-px-0"},{default:k(()=>[o("div",Nt,c(t.value?.description),1)]),_:1}),d(xt,{class:"!tw-flex !tw-justify-between !tw-items-end tw-gap-2 !tw-p-0"},{default:k(()=>[o("div",Ft,[t.value?.discount?(u(),f(V,{key:0},[o("span",Lt,c(C(T)(t.value?.price)),1),o("span",Mt,c(C(T)(t.value?.discountedPrice||t.value?.price)),1)],64)):(u(),f(V,{key:1},[S(c(t.value?.price!==void 0?C(T)(t.value.price):""),1)],64))]),o("div",Rt,[d(E,{color:D.value,"text-color":j.value,outline:A.value,label:a.$t("singleProduct.goBack"),"class-name":"tw-flex-1 tw-basis-1/3",onClick:O},null,8,["color","text-color","outline","label"]),d(E,{color:j.value,"text-color":D.value,label:a.$t("singleProduct.addToCart"),"class-name":"tw-flex-1 tw-basis-2/3",onClick:e[1]||(e[1]=s=>t.value&&H(t.value))},null,8,["color","text-color","label"])])]),_:1})])])]))]),_:1}))}});export{Kt as default};
