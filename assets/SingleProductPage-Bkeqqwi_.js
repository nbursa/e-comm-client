import{p as Y,a7 as Z,a8 as J,c as p,B as k,C as $,D as K,a1 as ee,aT as h,z as te,y as ae,aU as F,aV as I,d as se,a4 as oe,aW as ne,al as ie,aj as le,ak as re,ab as ce,aX as ue,q as T,aY as de,A as me,o as u,a as V,w as x,h as v,e as f,aZ as pe,f as n,t as c,g as w,ag as B,Q as ve,F as E,k as M,aG as fe,j as ge,n as he,aN as Q}from"./index-Brc_VvUz.js";import{Q as we}from"./QImg-CbyGkr4i.js";import{Q as ye}from"./QPage-CD7AcyG7.js";import{f as A}from"./currency-q9S5wkF1.js";import{u as _e}from"./products-DUUllzJZ.js";import{api as be}from"./axios-DYu29VTx.js";import"./rates-DXBPBOLn.js";const ke=Y({name:"QBanner",props:{...Z,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:s}){const{proxy:{$q:d}}=K(),m=J(i,d),q=p(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(m.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),y=p(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const l=[k("div",{class:"q-banner__avatar col-auto row items-center self-start"},$(s.avatar)),k("div",{class:"q-banner__content col text-body2"},$(s.default))],g=$(s.action);return g!==void 0&&l.push(k("div",{class:y.value},g)),k("div",{class:q.value+(i.inlineActions===!1&&g!==void 0?" q-banner--top-padding":""),role:"alert"},l)}}});function z(i){{const s={active:!0};if(typeof i=="function"){const d=p(i);s.val=d.value,ee(d,m=>{s.val=m,s.active===!0&&h()})}else s.val=i;I.push(s),h(),te(()=>{s.active=!0,h()}),ae(()=>{s.active=!1,h()}),F(()=>{I.splice(I.indexOf(s),1),h()})}}const xe={key:0,class:"q-pa-md"},qe={key:1,class:"q-pa-md"},Ce={key:2,class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},Pe={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},$e={key:0},Ie={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},Te={class:"tw-flex tw-justify-start tw-gap-2"},Be={class:"tw-text-sm tw-mb-2"},Qe={class:"tw-text-xs"},Ae={class:"text-caption q-mt-sm"},Se={class:"q-mt-sm text-bold price-text"},Ue={class:"text-grey"},De={class:"text-positive q-ml-sm"},je={class:"row justify-center q-mt-xl"},Re=se({__name:"SingleProductPage",setup(i){const s=oe("scrollToTop"),d="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),m=new Map,q=ne(),y=ie(),l=le(),g=re(),{t:_}=ce(),S=_e(),L=ue(),e=T({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),b=T(!0),C=T(null),U=p(()=>l.dark.isActive?"white":"black"),D=p(()=>l.dark.isActive?"black":"white"),j=p(()=>`${e.value.name||e.value.title} - ${de}`),P=o=>{if(!o)return"";const t=`${d}${o}`;console.log("imagePath:",o,"fullUrl:",t);const r=m.get(t);return r||(m.set(t,t),t)},R=p(()=>e.value?.image?P(e.value.image):""),G=o=>{const t=[{src:P(o),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const r=e.value.additionalImages.map(a=>({src:P(a),name:e.value.name||e.value.title||""}));t.push(...r)}L.openPreview(t)},H=o=>{g.addItem({...o,quantity:1}),s(),l.notify({color:"positive",position:"top",timeout:1e3,message:_("singleProduct.itemAdded"),icon:"check_circle"})},O=()=>{y.push(Q)},W=async()=>{const{slug:o}=q.params;b.value=!0,l.loading.show();try{const t=S.getViewedCache();if(t){const N=t.products.find(X=>X.id===Number(o));if(N){e.value=N,z({title:j.value}),b.value=!1;return}}const r=await be.get(`${d}${Q}/${o}`);if(r.status!==200)throw new Error("Failed to fetch product");const{data:a}=r.data;e.value={id:a.id,name:a.name,title:a.title||a.name,price:Number(a.price),description:a.description,image:a.image,additionalImages:a.additionalImages||[],category:a.category,discount:a.discount||0,discountedPrice:a.price-a.price*(a.discount||10)/100,quantity:a.quantity||0,rating:a.rating||{rate:0,count:0}},S.setViewedCache(e.value),z({title:j.value})}catch(t){console.warn("Error fetching product:",t),C.value=_("errors.fetchProduct"),l.notify({color:"negative",position:"top",timeout:1e3,message:_("errors.fetchProduct"),icon:"error"}),e.value.id||y.push(Q)}finally{l.loading.hide(),b.value=!1}};return me(()=>{W()}),F(()=>{m.clear()}),(o,t)=>(u(),V(ye,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:x(()=>[b.value?(u(),v("div",xe,[f(pe,{color:"primary",size:"50px"})])):C.value?(u(),v("div",qe,[f(ke,{type:"negative",class:"q-mb-md"},{default:x(()=>[n("div",null,c(C.value),1)]),_:1})])):(u(),v("div",Ce,[n("div",{class:he(["row items-stretch full-height",{"col-reverse-md":w(l).screen.md}])},[n("div",Pe,[e.value.image?(u(),V(we,{key:1,src:R.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:t[0]||(t[0]=r=>G(e.value.image))},null,8,["src","alt"])):(u(),v("div",$e,c(w(_)("errors.noImage")),1))]),n("div",Ie,[f(ve,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:x(()=>[n("h5",Te,[n("span",null,c(e.value.name||e.value.title),1),n("span",Be,[B("("+c(e.value.quantity)+" ",1),n("span",Qe,c(o.$t("singleProduct.quantity")),1),t[2]||(t[2]=B(")"))])]),n("div",Ae,c(e.value.description),1)]),_:1}),f(ge,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:x(()=>[n("div",Se,[e.value.discount?(u(),v(E,{key:0},[n("s",Ue,c(w(A)(e.value.price)),1),n("span",De,c(w(A)(e.value.discountedPrice||e.value.price)),1)],64)):(u(),v(E,{key:1},[B(c(w(A)(e.value.price)),1)],64))]),f(M,{color:U.value,"text-color":D.value,label:o.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:t[1]||(t[1]=fe(r=>H(e.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)])),n("div",je,[f(M,{color:U.value,"text-color":D.value,label:o.$t("singleProduct.backToProducts"),onClick:O},null,8,["color","text-color","label"])])]),_:1}))}});export{Re as default};
