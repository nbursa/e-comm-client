import{p as J,$ as K,a0 as ee,c as d,v as b,V as T,A as te,S as ae,aT as f,a6 as se,a5 as oe,aU as ne,aV as A,d as ie,X as re,aW as ce,am as le,ak as ue,al as de,ab as me,aX as ve,x as k,aY as pe,a7 as ge,o as u,a as D,w as q,h as v,e as p,aZ as fe,f as n,t as c,n as N,g as w,ac as Q,Q as we,F as E,k as M,ae as he,j as ye,aN as S}from"./index-D6IBDAa9.js";import{Q as _e}from"./QImg-DMowM_mF.js";import{Q as xe}from"./QPage-pFPcYb7G.js";import{f as B}from"./currency-DuG1702M.js";import{u as be}from"./products-B6mfLIMy.js";import{api as ke}from"./axios-Drl8hg_6.js";import"./rates-C_l-4kDJ.js";const qe=J({name:"QBanner",props:{...K,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:o}){const{proxy:{$q:m}}=te(),g=ee(i,m),h=d(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(g.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),r=d(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const y=[b("div",{class:"q-banner__avatar col-auto row items-center self-start"},T(o.avatar)),b("div",{class:"q-banner__content col text-body2"},T(o.default))],l=T(o.action);return l!==void 0&&y.push(b("div",{class:r.value},l)),b("div",{class:h.value+(i.inlineActions===!1&&l!==void 0?" q-banner--top-padding":""),role:"alert"},y)}}});function Ce(i){{const o={active:!0};if(typeof i=="function"){const m=d(i);o.val=m.value,ae(m,g=>{o.val=g,o.active===!0&&f()})}else o.val=i;A.push(o),f(),se(()=>{o.active=!0,f()}),oe(()=>{o.active=!1,f()}),ne(()=>{A.splice(A.indexOf(o),1),f()})}}const Pe={key:0,class:"q-pa-md"},Ie={key:1,class:"q-pa-md"},$e={key:2,class:"q-mb-md q-mx-auto overflow-hidden !tw-w-full row items-stretch justify-center",style:{"max-width":"1200px"}},Te={class:"col-12 col-sm-6 col-md-4 tw-px-2 sm:tw-px-0 tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},Ae={class:"col-12 col-sm-6 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},Qe={class:"tw-flex tw-justify-between tw-gap-2"},Se={class:"tw-text-base md:tw-text-xl"},Be={class:"tw-text-sm tw-mb-2"},Ue={class:"tw-text-xs"},je={class:"text-caption q-mt-sm"},Ve={class:"q-mt-sm text-bold price-text"},De={class:"text-grey"},Ne={class:"text-positive q-ml-sm"},Ee={class:"row justify-center q-mt-xl"},He=ie({__name:"SingleProductPage",setup(i){const o=re("scrollToTop"),m="https://e-comm-backend-16bba1769344.herokuapp.com/api".replace(/\/$/,""),g=ce(),h=le(),r=ue(),y=de(),{t:l}=me(),C=be(),F=ve(),{slug:U}=g.params,e=k({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),_=k(!0),P=k(null),I=k(new Map),L=d(()=>r.dark.isActive),j=d(()=>r.dark.isActive?"white":"black"),V=d(()=>r.dark.isActive?"black":"white"),R=d(()=>`${e.value.name||e.value.title} - ${pe}`),z=a=>{if(!I.value.has(a)){const t=new Image;t.src=a,t.onload=()=>{I.value.set(a,t)}}},X=a=>{const t=I.value.get(a);return t?t.src:a},$=a=>{if(!a)return"";const t=`${m}${a}`,s=X(t);return s||(z(t),t)},G=d(()=>e.value?.image?$(e.value.image):""),H=a=>{const t=[{src:$(a),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const s=e.value.additionalImages.map(x=>({src:$(x),name:e.value.name||e.value.title||""}));t.push(...s)}F.openPreview(t)},O=a=>{y.addItem({...a,quantity:1}),o(),r.notify({color:"positive",position:"top",timeout:1e3,message:l("singleProduct.itemAdded"),icon:"check_circle"})},W=()=>{h.push(S)},Y=async()=>{_.value=!0,r.loading.show();try{C.initViewedCache();const a=C.getViewedCache();if(a){const x=a.products.find(Z=>Z.id===Number(U));if(x){e.value=x,_.value=!1;return}}const t=await ke.get(`${m}${S}/${U}`);if(t.status!==200)throw new Error("Failed to fetch product");const{data:s}=t.data;e.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},C.setViewedCache(e.value)}catch(a){console.warn("Error fetching product:",a),P.value=l("errors.fetchProduct"),r.notify({color:"negative",position:"top",timeout:1e3,message:l("errors.fetchProduct"),icon:"error"}),e.value.id||h.push(S)}finally{r.loading.hide(),_.value=!1}};return ge(()=>{Y(),Ce({title:R.value})}),(a,t)=>(u(),D(xe,{padding:"",class:"!tw-pb-16 md:!tw-pb-24 !tw-pt-4"},{default:q(()=>[_.value?(u(),v("div",Pe,[p(fe,{color:"primary",size:"50px"})])):P.value?(u(),v("div",Ie,[p(qe,{type:"negative",class:"q-mb-md"},{default:q(()=>[n("div",null,c(P.value),1)]),_:1})])):(u(),v("div",$e,[n("div",{class:N(["row items-stretch full-height !tw-w-full justify-center",{"col-reverse-md":w(r).screen.sm}])},[n("div",Te,[e.value.image?(u(),D(_e,{key:1,src:G.value,alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:t[0]||(t[0]=s=>H(e.value.image))},null,8,["src","alt"])):(u(),v("div",{key:0,class:N(["tw-h-full tw-w-full tw-flex tw-items-center tw-justify-center tw-rounded 0 tw-border tw-border-gray-400",L.value?"tw-text-gray-200  !tw-bg-gray-700":"tw-text-gray-70 !tw-bg-gray-200"])},c(w(l)("errors.noImage")),3))]),n("div",Ae,[p(we,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:q(()=>[n("h5",Qe,[n("span",Se,c(e.value.name||e.value.title),1),n("span",Be,[Q("("+c(e.value.quantity)+" ",1),n("span",Ue,c(a.$t("singleProduct.quantity")),1),t[2]||(t[2]=Q(")"))])]),n("div",je,c(e.value.description),1)]),_:1}),p(ye,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:q(()=>[n("div",Ve,[e.value.discount?(u(),v(E,{key:0},[n("s",De,c(w(B)(e.value.price)),1),n("span",Ne,c(w(B)(e.value.discountedPrice||e.value.price)),1)],64)):(u(),v(E,{key:1},[Q(c(w(B)(e.value.price)),1)],64))]),p(M,{color:j.value,"text-color":V.value,label:a.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:t[1]||(t[1]=he(s=>O(e.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)])),n("div",Ee,[p(M,{color:j.value,"text-color":V.value,label:a.$t("singleProduct.backToProducts"),onClick:W},null,8,["color","text-color","label"])])]),_:1}))}});export{He as default};
