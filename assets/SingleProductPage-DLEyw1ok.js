import{Q as N,f as g}from"./currency-Dd4uVeOV.js";import{Y as E,O as L,aJ as M,ah as R,af as W,ag as D,ai as F,aK as O,r as z,w as b,h as J,aL as K,Z as f,_ as Y,$ as v,a2 as a,aa as Z,a4 as m,a0 as d,a3 as l,an as w,a1 as G,a5 as k,a7 as q,a9 as $,ao as H,a8 as X}from"./index-D9HPICo4.js";import{Q as tt}from"./QPage-BYCHHSuK.js";import{u as et}from"./products-Bf0TLtOw.js";import"./rates-CLq5MDrq.js";const ot={class:"q-mb-md q-mx-auto overflow-hidden",style:{"max-width":"1200px"}},st={class:"col-12 col-md-4 q-py-lg tw-transition tw-duration-200 tw-ease-in-out hover:tw-scale-105"},at={class:"col-12 col-md-8 sm:tw-p-3 !tw-align-top",style:{display:"flex","flex-direction":"column","flex-grow":"0",height:"auto","min-height":"100%"}},it={class:"tw-flex tw-justify-start tw-gap-2"},ct={class:"tw-text-sm tw-mb-2"},lt={class:"tw-text-xs"},rt={class:"text-caption q-mt-sm"},nt={class:"q-mt-sm text-bold price-text"},dt={class:"text-grey"},ut={class:"text-positive q-ml-sm"},pt={class:"row justify-center q-mt-xl"},xt=E({__name:"SingleProductPage",setup(mt){const I=L("scrollToTop"),u="http://localhost:8080/api".replace(/\/$/,""),p=new Map,P=M(),y=R(),c=W(),Q=D(),{t:S}=F(),r=et(),T=O(),e=z({id:0,title:"",name:"",price:0,quantity:0,description:"",category:"",image:"",rating:{rate:0,count:0}}),x=b(()=>c.dark.isActive?"white":"black"),_=b(()=>c.dark.isActive?"black":"white"),h=t=>{if(!t)return"/assets/placeholder.webp";const o=p.get(t);if(o)return o;if(t.startsWith("/static")){const i=`${u}${t}`;return p.set(t,i),i}return t.startsWith("http")&&p.set(t,t),t},U=t=>{const o=[{src:h(t),name:e.value.name||e.value.title||""}];if(e.value.additionalImages?.length){const i=e.value.additionalImages.map(n=>({src:h(n),name:e.value.name||e.value.title||""}));o.push(...i)}T.openPreview(o)},A=t=>{Q.addItem({...t,quantity:1}),I(),c.notify({color:"positive",position:"top",timeout:1e3,message:S("singleProduct.itemAdded"),icon:"check_circle"})},B=()=>{y.push("/products")},V=async()=>{const{slug:t}=P.params;c.loading.show();try{console.log("Checking cache for product:",t);const o=r.getCache("viewed");if(console.log("Viewed cache:",o),o&&r.isCacheValid("viewed")){const C=o.products.find(j=>j.id===Number(t));if(C){console.log("Cache hit for product:",t),e.value=C;return}}console.log("Cache miss, fetching from API");const i=u.endsWith("/products")?u.slice(0,-9):u;console.log("API URL:",i,`${i}/products/${t}`);const n=await fetch(`${i}/products/${t}`);if(!n.ok)throw new Error(`API returned ${n.status}`);const s=(await n.json()).data;e.value={id:s.id,name:s.name,title:s.title||s.name,price:Number(s.price),description:s.description,image:s.image,additionalImages:s.additionalImages||[],category:s.category,discount:s.discount||0,discountedPrice:s.price-s.price*(s.discount||10)/100,quantity:s.quantity||0,rating:s.rating||{rate:0,count:0}},r.setCache([e.value],"viewed"),console.log("Updated cache with new product data")}catch(o){console.warn("Error fetching product:",o),c.notify({color:"negative",position:"top",timeout:1e3,message:"Failed to fetch product details.",icon:"error"}),e.value.id||y.push("/products")}finally{c.loading.hide()}};return J(async()=>{await V()}),K(()=>{p.clear(),r.isCacheValid("viewed")||(console.log("Clearing expired product cache"),r.setCache([],"viewed"))}),(t,o)=>(f(),Y(tt,{padding:"",class:"!tw-pb-16 md:tw-pb-24 !tw-pt-4"},{default:v(()=>[a("div",ot,[a("div",{class:Z(["row items-stretch full-height",{"col-reverse-md":m(c).screen.md}])},[a("div",st,[d(N,{src:h(e.value.image),alt:e.value.name,fit:"contain",class:"cursor-pointer full-width full-height",onClick:o[0]||(o[0]=i=>U(e.value.image))},null,8,["src","alt"])]),a("div",at,[d(G,{class:"q-pa-sm !tw-pb-0",style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},{default:v(()=>[a("h5",it,[a("span",null,l(e.value.name||e.value.title),1),a("span",ct,[w("("+l(e.value.quantity)+" ",1),a("span",lt,l(t.$t("singleProduct.quantity")),1),o[2]||(o[2]=w(")"))])]),a("div",rt,l(e.value.description),1)]),_:1}),d(X,{align:"right",class:"row justify-between items-end !tw-pt-0"},{default:v(()=>[a("div",nt,[e.value.discount?(f(),k(q,{key:0},[a("s",dt,l(m(g)(e.value.price)),1),a("span",ut,l(m(g)(e.value.discountedPrice||e.value.price)),1)],64)):(f(),k(q,{key:1},[w(l(m(g)(e.value.price)),1)],64))]),d($,{color:x.value,"text-color":_.value,label:t.$t("singleProduct.addToCart"),class:"!tw-p-4 full-width",onClick:o[1]||(o[1]=H(i=>A(e.value),["stop"]))},null,8,["color","text-color","label"])]),_:1})])],2)]),a("div",pt,[d($,{color:x.value,"text-color":_.value,label:t.$t("singleProduct.backToProducts"),onClick:B},null,8,["color","text-color","label"])])]),_:1}))}});export{xt as default};
